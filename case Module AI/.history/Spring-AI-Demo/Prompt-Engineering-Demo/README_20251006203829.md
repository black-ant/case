# Prompt Engineering Demo - 提示工程与模板系统

这个项目展示了如何使用 Spring AI 实现高级提示工程技术和对话记忆管理。

## 🎯 什么是提示工程？

提示工程（Prompt Engineering）是设计和优化输入提示词的艺术，以获得更好的 AI 输出。

### 核心技术

1. **提示模板**：可复用的提示词结构
2. **Few-Shot 学习**：通过示例引导 AI
3. **Chain-of-Thought**：引导 AI 展示思考过程
4. **对话记忆**：维护多轮对话上下文

## 🚀 快速开始

```bash
export OPENAI_API_KEY=sk-xxx
mvn spring-boot:run
```

## 📡 API 接口

### 提示模板

#### 1. 复杂分析模板

```bash
curl -X POST http://localhost:8080/api/prompt/template/analysis \
  -H "Content-Type: application/json" \
  -d '{
    "domain": "市场营销",
    "experienceLevel": 10,
    "context": "电商行业竞争激烈",
    "task": "分析当前市场趋势",
    "requirements": ["数据驱动", "可执行建议", "风险评估"],
    "outputFormat": "结构化报告",
    "constraints": "1000字以内"
  }'
```

#### 2. 多轮对话模板

```bash
curl -X POST http://localhost:8080/api/prompt/template/multi-turn \
  -H "Content-Type: application/json" \
  -d '{
    "topic": "人工智能",
    "questions": [
      "什么是人工智能？",
      "它有哪些应用？",
      "未来发展趋势如何？"
    ]
  }'
```

#### 3. 角色扮演模板

```bash
curl -X POST http://localhost:8080/api/prompt/template/role-play \
  -H "Content-Type: application/json" \
  -d '{
    "role": "资深软件架构师",
    "scenario": "正在进行系统架构评审",
    "userInput": "我们应该使用微服务架构吗？"
  }'
```

#### 4. 结构化输出模板

```bash
curl -X POST http://localhost:8080/api/prompt/template/structured \
  -H "Content-Type: application/json" \
  -d '{
    "topic": "Spring Boot 特性",
    "format": "JSON格式：{\"features\": [{\"name\": \"\", \"description\": \"\"}]}"
  }'
```

#### 5. Few-Shot 学习模板

```bash
curl -X POST http://localhost:8080/api/prompt/template/few-shot \
  -H "Content-Type: application/json" \
  -d '{
    "task": "情感分类",
    "examples": [
      {"input": "这个产品太棒了！", "output": "积极"},
      {"input": "质量很差，不推荐", "output": "消极"}
    ],
    "input": "还可以，有待改进"
  }'
```

#### 6. Chain-of-Thought 模板

```bash
curl -X POST http://localhost:8080/api/prompt/template/chain-of-thought \
  -H "Content-Type: application/json" \
  -d '{
    "message": "如果一个房间里有3只猫，每只猫抓到2只老鼠，总共抓到多少只老鼠？"
  }'
```

### 对话记忆

#### 7. 带记忆的对话

```bash
# 第一轮对话
curl -X POST http://localhost:8080/api/prompt/memory/chat \
  -H "Content-Type: application/json" \
  -d '{
    "sessionId": "user123",
    "message": "我叫张三，是一名程序员"
  }'

# 第二轮对话（AI 会记住之前的内容）
curl -X POST http://localhost:8080/api/prompt/memory/chat \
  -H "Content-Type: application/json" \
  -d '{
    "sessionId": "user123",
    "message": "我叫什么名字？"
  }'
```

#### 8. 获取对话历史

```bash
curl http://localhost:8080/api/prompt/memory/history/user123
```

#### 9. 压缩对话记忆

```bash
curl -X POST http://localhost:8080/api/prompt/memory/compress/user123
```

#### 10. 清除对话记忆

```bash
curl -X DELETE http://localhost:8080/api/prompt/memory/clear/user123
```

#### 11. 列出所有会话

```bash
curl http://localhost:8080/api/prompt/memory/sessions
```

## 🎨 提示工程技巧

### 1. 明确角色和专业性

```
你是一个拥有 10 年经验的专业市场分析师。
```

### 2. 提供清晰的上下文

```
背景信息：电商行业竞争激烈，用户获取成本上升...
```

### 3. 具体的任务描述

```
任务：分析当前市场趋势，并提供可执行的营销建议。
```

### 4. 列出明确的要求

```
要求：
- 数据驱动的分析
- 可执行的建议
- 风险评估
```

### 5. 指定输出格式

```
输出格式：结构化报告，包含摘要、分析和建议三部分。
```

### 6. 添加约束条件

```
额外约束：1000字以内，使用简洁的语言。
```

## 💡 高级技术

### Few-Shot Learning

通过提供示例来引导 AI：

```
示例 1:
输入：这个产品太棒了！
输出：积极

示例 2:
输入：质量很差，不推荐
输出：消极

现在处理：还可以，有待改进
```

### Chain-of-Thought

引导 AI 展示思考过程：

```
问题：如果一个房间里有3只猫，每只猫抓到2只老鼠，总共抓到多少只老鼠？

请使用思维链方法：
1. 理解问题
2. 分步骤思考
3. 进行推理
4. 给出答案
```

### 对话记忆管理

```
会话 1: "我叫张三"
会话 2: "我是程序员"
会话 3: "我叫什么名字？" → AI 回答："你叫张三"
```

## 📊 对话记忆策略

### 1. 滑动窗口记忆

保留最近的 N 条消息：

```yaml
conversation:
  memory:
    max-messages: 10
```

### 2. 记忆压缩

当消息过多时，压缩旧消息为摘要：

```
原始：20 条消息
压缩后：1 条摘要 + 5 条最近消息
```

### 3. 多会话管理

为不同用户维护独立的对话记忆：

```
user123 → 会话 A
user456 → 会话 B
```

## 🎓 最佳实践

### 1. 提示词设计原则

- **清晰明确**：避免模糊的描述
- **结构化**：使用模板组织提示词
- **可复用**：设计通用的模板
- **迭代优化**：根据输出调整提示词

### 2. 对话记忆管理

- **及时清理**：避免记忆过载
- **定期压缩**：保持记忆精简
- **会话隔离**：不同用户独立记忆

### 3. 性能优化

- **缓存模板**：避免重复创建
- **异步处理**：提高响应速度
- **批量操作**：减少 API 调用

## 📝 总结

这个 Prompt Engineering Demo 展示了：

✅ **6 种提示模板**：分析、多轮对话、角色扮演、结构化输出、Few-Shot、CoT  
✅ **对话记忆管理**：创建、查询、压缩、清除  
✅ **多会话支持**：独立的用户会话  
✅ **高级技术**：Few-Shot Learning、Chain-of-Thought  

通过提示工程，你可以显著提升 AI 的输出质量和准确性！
