# Function Calling å®Œæ•´ç¤ºä¾‹

è¿™ä¸ªæ–‡æ¡£æä¾›äº†é™æ€å’ŒåŠ¨æ€å‡½æ•°è°ƒç”¨çš„å®Œæ•´ç¤ºä¾‹ã€‚

## ğŸ“š ç›®å½•

1. [é™æ€å‡½æ•°ç¤ºä¾‹](#é™æ€å‡½æ•°ç¤ºä¾‹)
2. [åŠ¨æ€å‡½æ•°ç¤ºä¾‹](#åŠ¨æ€å‡½æ•°ç¤ºä¾‹)
3. [å®æˆ˜åœºæ™¯](#å®æˆ˜åœºæ™¯)
4. [å¯¹æ¯”åˆ†æ](#å¯¹æ¯”åˆ†æ)

---

## é™æ€å‡½æ•°ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šå¤©æ°”æŸ¥è¯¢

```bash
curl -X POST http://localhost:8080/api/function/auto \
  -H "Content-Type: application/json" \
  -d '{
    "message": "åŒ—äº¬ä»Šå¤©å¤©æ°”æ€ä¹ˆæ ·ï¼Ÿ"
  }'
```

**AI æ‰§è¡Œæµç¨‹**ï¼š
1. è¯†åˆ«æ„å›¾ï¼šæŸ¥è¯¢å¤©æ°”
2. é€‰æ‹©å‡½æ•°ï¼š`weatherFunction`
3. æå–å‚æ•°ï¼š`city="åŒ—äº¬"`
4. è°ƒç”¨å‡½æ•°å¹¶è¿”å›ç»“æœ

### ç¤ºä¾‹ 2ï¼šè‚¡ç¥¨æŸ¥è¯¢

```bash
curl -X POST http://localhost:8080/api/function/auto \
  -H "Content-Type: application/json" \
  -d '{
    "message": "è‹¹æœå…¬å¸è‚¡ç¥¨ç°åœ¨å¤šå°‘é’±ï¼Ÿ"
  }'
```

### ç¤ºä¾‹ 3ï¼šè®¡ç®—å™¨

```bash
curl -X POST http://localhost:8080/api/function/auto \
  -H "Content-Type: application/json" \
  -d '{
    "message": "å¸®æˆ‘ç®—ä¸€ä¸‹ 123 ä¹˜ä»¥ 456"
  }'
```

### ç¤ºä¾‹ 4ï¼šé“¾å¼è°ƒç”¨

```bash
curl -X POST http://localhost:8080/api/function/chain \
  -H "Content-Type: application/json" \
  -d '{
    "message": "åŒ—äº¬å’Œä¸Šæµ·ä»Šå¤©å“ªä¸ªåŸå¸‚æ›´çƒ­ï¼Ÿæ¸©å·®æ˜¯å¤šå°‘ï¼Ÿ"
  }'
```

**AI æ‰§è¡Œæµç¨‹**ï¼š
1. è°ƒç”¨ `weatherFunction("åŒ—äº¬")`
2. è°ƒç”¨ `weatherFunction("ä¸Šæµ·")`
3. è°ƒç”¨ `calculatorFunction(temp1, temp2, "subtract")`
4. ç»¼åˆç»“æœç”Ÿæˆå›ç­”

---

## åŠ¨æ€å‡½æ•°ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šæ‰¹é‡æ³¨å†Œå¹¶ä½¿ç”¨

```bash
# æ­¥éª¤ 1ï¼šæ‰¹é‡æ³¨å†Œç¤ºä¾‹å‡½æ•°
curl -X POST http://localhost:8080/api/dynamic/register/batch

# æ­¥éª¤ 2ï¼šæŸ¥çœ‹å·²æ³¨å†Œçš„å‡½æ•°
curl http://localhost:8080/api/dynamic/list

# æ­¥éª¤ 3ï¼šä½¿ç”¨å‡½æ•°
curl -X POST http://localhost:8080/api/dynamic/chat/all \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ä½ å¥½ï¼Œæˆ‘å«ææ˜ã€‚ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ"
  }'
```

**å“åº”ç¤ºä¾‹**ï¼š
```
ä½ å¥½ï¼Œææ˜ï¼å¾ˆé«˜å…´è§åˆ°ä½ ï¼ç°åœ¨æ˜¯ 2024-01-15T14:30:00
```

### ç¤ºä¾‹ 2ï¼šåŠ¨æ€æ³¨å†Œè‡ªå®šä¹‰å‡½æ•°

```bash
# æ³¨å†Œé—®å€™å‡½æ•°
curl -X POST http://localhost:8080/api/dynamic/register/example \
  -H "Content-Type: application/json" \
  -d '{
    "functionName": "customGreeting",
    "description": "è‡ªå®šä¹‰é—®å€™å‡½æ•°",
    "functionType": "greeting"
  }'

# ä½¿ç”¨å‡½æ•°
curl -X POST http://localhost:8080/api/dynamic/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹äº”",
    "functionNames": ["customGreeting"]
  }'

# æ³¨é”€å‡½æ•°
curl -X DELETE http://localhost:8080/api/dynamic/unregister/customGreeting
```

### ç¤ºä¾‹ 3ï¼šåŠ¨æ€åˆ‡æ¢å‡½æ•°ç‰ˆæœ¬

```bash
# æ³¨å†Œç‰ˆæœ¬ 1
curl -X POST http://localhost:8080/api/dynamic/register/example \
  -H "Content-Type: application/json" \
  -d '{
    "functionName": "recommend",
    "description": "æ¨èç®—æ³• v1",
    "functionType": "random"
  }'

# æµ‹è¯•ç‰ˆæœ¬ 1
curl -X POST http://localhost:8080/api/dynamic/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ç»™æˆ‘æ¨èä¸€ä¸ªæ•°å­—",
    "functionNames": ["recommend"]
  }'

# åˆ‡æ¢åˆ°ç‰ˆæœ¬ 2
curl -X DELETE http://localhost:8080/api/dynamic/unregister/recommend

curl -X POST http://localhost:8080/api/dynamic/register/example \
  -H "Content-Type: application/json" \
  -d '{
    "functionName": "recommend",
    "description": "æ¨èç®—æ³• v2ï¼ˆæ”¹è¿›ç‰ˆï¼‰",
    "functionType": "math"
  }'

# æµ‹è¯•ç‰ˆæœ¬ 2
curl -X POST http://localhost:8080/api/dynamic/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ç»™æˆ‘æ¨èä¸€ä¸ªæ•°å­—",
    "functionNames": ["recommend"]
  }'
```

---

## å®æˆ˜åœºæ™¯

### åœºæ™¯ 1ï¼šæ™ºèƒ½å®¢æœç³»ç»Ÿ

#### é™æ€å‡½æ•°ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
```java
@Bean
@Description("æŸ¥è¯¢è®¢å•çŠ¶æ€")
public Function<OrderRequest, OrderResponse> queryOrder() {
    return request -> orderService.query(request.getOrderId());
}

@Bean
@Description("å–æ¶ˆè®¢å•")
public Function<CancelRequest, CancelResponse> cancelOrder() {
    return request -> orderService.cancel(request.getOrderId());
}
```

#### åŠ¨æ€å‡½æ•°ï¼ˆä¸´æ—¶åŠŸèƒ½ï¼‰
```java
// ä¿ƒé”€æ´»åŠ¨æœŸé—´åŠ¨æ€æ·»åŠ 
dynamicFunctionService.registerSimpleFunction(
    "checkPromotion",
    "æŸ¥è¯¢ä¿ƒé”€æ´»åŠ¨",
    params -> promotionService.check((String) params.get("productId"))
);

// æ´»åŠ¨ç»“æŸåç§»é™¤
dynamicFunctionService.unregisterFunction("checkPromotion");
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
curl -X POST http://localhost:8080/api/function/auto \
  -H "Content-Type: application/json" \
  -d '{
    "message": "æˆ‘æƒ³æŸ¥ä¸€ä¸‹è®¢å• 12345 çš„çŠ¶æ€"
  }'
```

### åœºæ™¯ 2ï¼šæ•°æ®åˆ†æåŠ©æ‰‹

#### é™æ€å‡½æ•°ï¼ˆåŸºç¡€æŸ¥è¯¢ï¼‰
```java
@Bean
@Description("æŸ¥è¯¢é”€å”®æ•°æ®")
public Function<QueryRequest, QueryResponse> querySales() {
    return request -> salesService.query(request);
}
```

#### åŠ¨æ€å‡½æ•°ï¼ˆè‡ªå®šä¹‰åˆ†æï¼‰
```java
// ç”¨æˆ·è‡ªå®šä¹‰åˆ†æç»´åº¦
dynamicFunctionService.registerSimpleFunction(
    "analyzeByRegion",
    "æŒ‰åœ°åŒºåˆ†æé”€å”®æ•°æ®",
    params -> {
        String region = (String) params.get("region");
        return analyticsService.analyzeByRegion(region);
    }
);

dynamicFunctionService.registerSimpleFunction(
    "analyzeByProduct",
    "æŒ‰äº§å“åˆ†æé”€å”®æ•°æ®",
    params -> {
        String product = (String) params.get("product");
        return analyticsService.analyzeByProduct(product);
    }
);
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
curl -X POST http://localhost:8080/api/dynamic/chat/all \
  -H "Content-Type: application/json" \
  -d '{
    "message": "å¸®æˆ‘åˆ†æä¸€ä¸‹åä¸œåœ°åŒºçš„é”€å”®æƒ…å†µ"
  }'
```

### åœºæ™¯ 3ï¼šæ’ä»¶ç³»ç»Ÿ

```java
@Service
public class PluginManager {
    
    @Autowired
    private DynamicFunctionService dynamicFunctionService;
    
    // ç”¨æˆ·å®‰è£…æ’ä»¶
    public void installPlugin(Plugin plugin) {
        plugin.getFunctions().forEach((name, function) -> {
            dynamicFunctionService.registerSimpleFunction(
                name,
                function.getDescription(),
                function.getImplementation()
            );
        });
    }
    
    // ç”¨æˆ·å¸è½½æ’ä»¶
    public void uninstallPlugin(Plugin plugin) {
        plugin.getFunctions().keySet().forEach(
            dynamicFunctionService::unregisterFunction
        );
    }
}
```

**ä½¿ç”¨ç¤ºä¾‹**ï¼š
```bash
# å®‰è£…ç¿»è¯‘æ’ä»¶
POST /plugins/install
{
  "pluginId": "translator",
  "functions": {
    "translateText": {
      "description": "ç¿»è¯‘æ–‡æœ¬",
      "implementation": "..."
    }
  }
}

# ä½¿ç”¨ç¿»è¯‘åŠŸèƒ½
curl -X POST http://localhost:8080/api/dynamic/chat/all \
  -H "Content-Type: application/json" \
  -d '{
    "message": "æŠŠ Hello World ç¿»è¯‘æˆä¸­æ–‡"
  }'
```

---

## å¯¹æ¯”åˆ†æ

### é™æ€ vs åŠ¨æ€å‡½æ•°

| ç‰¹æ€§ | é™æ€å‡½æ•° | åŠ¨æ€å‡½æ•° |
|------|---------|---------|
| **æ³¨å†Œæ—¶æœº** | åº”ç”¨å¯åŠ¨æ—¶ | è¿è¡Œæ—¶ |
| **çµæ´»æ€§** | ä½ | é«˜ |
| **æ€§èƒ½** | æ›´å¥½ | ç•¥ä½ |
| **ç±»å‹å®‰å…¨** | å¼ºç±»å‹ | å¼±ç±»å‹ |
| **é€‚ç”¨åœºæ™¯** | æ ¸å¿ƒåŠŸèƒ½ | ä¸´æ—¶åŠŸèƒ½ã€æ’ä»¶ |
| **ç®¡ç†å¤æ‚åº¦** | ä½ | ä¸­ç­‰ |

### ä½•æ—¶ä½¿ç”¨é™æ€å‡½æ•°ï¼Ÿ

âœ… æ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½  
âœ… é•¿æœŸç¨³å®šçš„åŠŸèƒ½  
âœ… éœ€è¦å¼ºç±»å‹æ£€æŸ¥  
âœ… æ€§èƒ½è¦æ±‚é«˜  

### ä½•æ—¶ä½¿ç”¨åŠ¨æ€å‡½æ•°ï¼Ÿ

âœ… ä¸´æ—¶åŠŸèƒ½ï¼ˆå¦‚ä¿ƒé”€æ´»åŠ¨ï¼‰  
âœ… æ’ä»¶ç³»ç»Ÿ  
âœ… A/B æµ‹è¯•  
âœ… ç§Ÿæˆ·éš”ç¦»  
âœ… å¿«é€ŸåŸå‹å¼€å‘  

### æ··åˆä½¿ç”¨å»ºè®®

```java
@Service
public class HybridFunctionService {
    
    // é™æ€å‡½æ•°ï¼šæ ¸å¿ƒåŠŸèƒ½
    @Bean
    @Description("æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯")
    public Function<UserRequest, UserResponse> queryUser() {
        return request -> userService.query(request);
    }
    
    // åŠ¨æ€å‡½æ•°ï¼šæ‰©å±•åŠŸèƒ½
    @Autowired
    private DynamicFunctionService dynamicFunctionService;
    
    public void enableFeature(String featureName) {
        if ("vip".equals(featureName)) {
            dynamicFunctionService.registerSimpleFunction(
                "queryVipBenefits",
                "æŸ¥è¯¢ VIP æƒç›Š",
                params -> vipService.getBenefits((String) params.get("userId"))
            );
        }
    }
}
```

---

## å®Œæ•´å·¥ä½œæµç¤ºä¾‹

### ç¤ºä¾‹ï¼šæ™ºèƒ½åŠ©æ‰‹å®Œæ•´å¯¹è¯

```bash
# 1. åˆå§‹åŒ–ï¼šæ‰¹é‡æ³¨å†Œå‡½æ•°
curl -X POST http://localhost:8080/api/dynamic/register/batch

# 2. ç”¨æˆ·å¯¹è¯ 1
curl -X POST http://localhost:8080/api/dynamic/chat/all \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ä½ å¥½ï¼Œæˆ‘å«å¼ ä¸‰"
  }'
# å“åº”ï¼šä½ å¥½ï¼Œå¼ ä¸‰ï¼å¾ˆé«˜å…´è§åˆ°ä½ ï¼

# 3. ç”¨æˆ·å¯¹è¯ 2
curl -X POST http://localhost:8080/api/dynamic/chat/all \
  -H "Content-Type: application/json" \
  -d '{
    "message": "ç°åœ¨å‡ ç‚¹äº†ï¼Ÿ"
  }'
# å“åº”ï¼šç°åœ¨æ˜¯ 2024-01-15T14:30:00

# 4. ç”¨æˆ·å¯¹è¯ 3
curl -X POST http://localhost:8080/api/dynamic/chat/all \
  -H "Content-Type: application/json" \
  -d '{
    "message": "å¸®æˆ‘ç”Ÿæˆä¸€ä¸ª 1 åˆ° 100 çš„éšæœºæ•°"
  }'
# å“åº”ï¼šæˆ‘ä¸ºä½ ç”Ÿæˆäº†ä¸€ä¸ªéšæœºæ•°ï¼š42

# 5. ç”¨æˆ·å¯¹è¯ 4ï¼ˆå¤æ‚æŸ¥è¯¢ï¼‰
curl -X POST http://localhost:8080/api/dynamic/chat/all \
  -H "Content-Type: application/json" \
  -d '{
    "message": "æŠŠ HELLO è½¬æ¢æˆå¤§å†™ï¼Œç„¶åå‘Šè¯‰æˆ‘å®ƒæœ‰å‡ ä¸ªå­—ç¬¦"
  }'
# AI ä¼šä¾æ¬¡è°ƒç”¨ toUpperCase å’Œ getStringLength å‡½æ•°
# å“åº”ï¼šHELLO å·²ç»æ˜¯å¤§å†™äº†ï¼Œå®ƒæœ‰ 5 ä¸ªå­—ç¬¦

# 6. æ¸…ç†ï¼šæ³¨é”€ä¸éœ€è¦çš„å‡½æ•°
curl -X DELETE http://localhost:8080/api/dynamic/unregister/getRandomNumber
```

---

## è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹å‡½æ•°è°ƒç”¨æ—¥å¿—

```yaml
logging:
  level:
    org.springframework.ai: DEBUG
    com.example.functioncalling: DEBUG
```

### 2. ç›‘æ§å‡½æ•°æ‰§è¡Œ

```bash
# æŸ¥çœ‹å·²æ³¨å†Œçš„å‡½æ•°
curl http://localhost:8080/api/dynamic/list

# æ£€æŸ¥ç‰¹å®šå‡½æ•°
curl http://localhost:8080/api/dynamic/check/greetUser
```

### 3. æµ‹è¯•å‡½æ•°æ˜¯å¦æ­£å¸¸å·¥ä½œ

```bash
# å…ˆæ³¨å†Œå‡½æ•°
curl -X POST http://localhost:8080/api/dynamic/register/example \
  -H "Content-Type: application/json" \
  -d '{
    "functionName": "testFunction",
    "description": "æµ‹è¯•å‡½æ•°",
    "functionType": "greeting"
  }'

# æµ‹è¯•è°ƒç”¨
curl -X POST http://localhost:8080/api/dynamic/chat \
  -H "Content-Type: application/json" \
  -d '{
    "message": "æµ‹è¯•ä¸€ä¸‹",
    "functionNames": ["testFunction"]
  }'

# æ¸…ç†
curl -X DELETE http://localhost:8080/api/dynamic/unregister/testFunction
```

---

## æ€»ç»“

Function Calling æ˜¯ Spring AI æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ï¼š

âœ… **é™æ€å‡½æ•°**ï¼šé€‚åˆæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ï¼Œæ€§èƒ½å¥½ï¼Œç±»å‹å®‰å…¨  
âœ… **åŠ¨æ€å‡½æ•°**ï¼šé€‚åˆä¸´æ—¶åŠŸèƒ½å’Œæ’ä»¶ç³»ç»Ÿï¼Œçµæ´»æ€§é«˜  
âœ… **æ··åˆä½¿ç”¨**ï¼šç»“åˆä¸¤è€…ä¼˜åŠ¿ï¼Œæ„å»ºå¼ºå¤§çš„ AI åº”ç”¨  

é€šè¿‡åˆç†ä½¿ç”¨é™æ€å’ŒåŠ¨æ€å‡½æ•°ï¼Œä½ å¯ä»¥æ„å»ºå‡ºæ—¢ç¨³å®šåˆçµæ´»çš„æ™ºèƒ½åº”ç”¨ï¼
