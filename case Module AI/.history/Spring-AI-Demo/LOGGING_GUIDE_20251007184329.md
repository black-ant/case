# Spring AI Demo 日志配置指南

## 📋 概述

所有子模块都已配置了统一的日志系统，使用 Logback 作为日志框架。

## 🎯 日志配置

### 日志文件位置

每个子模块的日志文件都存储在各自的 `logs/` 目录下：

```
Spring-AI-Demo/
├── Sample-Spring-AI/logs/
│   ├── sample-spring-ai.log      # 所有日志
│   └── error.log                  # 错误日志
├── Multi-LLM-Provider/logs/
│   ├── multi-llm-provider.log
│   └── error.log
├── Streaming-Demo/logs/
│   ├── streaming-demo.log
│   └── error.log
└── ... (其他子模块类似)
```

### 日志级别

默认日志级别配置：

- **应用代码**: `DEBUG` - 详细记录应用逻辑
- **Spring AI**: `DEBUG` - 记录 AI 调用详情
- **Spring Framework**: `INFO` - 记录框架信息
- **Root**: `INFO` - 默认级别

### 日志格式

```
yyyy-MM-dd HH:mm:ss.SSS [线程名] 级别 类名 - 消息
```

示例：
```
2025-10-07 14:30:45.123 [http-nio-8080-exec-1] INFO  c.e.streaming.service.StreamingService - 基础流式响应: 你好
```

## 🔧 自定义日志配置

### 修改日志级别

在 `application.yml` 中添加：

```yaml
logging:
  level:
    root: INFO
    com.example: DEBUG
    org.springframework.ai: DEBUG
    org.springframework.web: DEBUG
```

### 修改日志文件路径

编辑 `src/main/resources/logback-spring.xml`：

```xml
<property name="LOG_FILE_PATH" value="自定义路径"/>
```

### 修改日志保留时间

在 `logback-spring.xml` 中：

```xml
<maxHistory>30</maxHistory>  <!-- 保留30天 -->
```

### 修改单个日志文件大小

```xml
<maxFileSize>10MB</maxFileSize>  <!-- 单文件最大10MB -->
```

## 📊 日志内容

### 各模块记录的关键日志

#### 1. Sample-Spring-AI
- API 调用请求和响应
- 高级功能使用情况
- 错误和异常

#### 2. Multi-LLM-Provider
- 不同 LLM 提供商的调用
- 自定义通道操作
- 请求路由信息

#### 3. Streaming-Demo
- 流式响应开始和完成
- 数据块传输
- 错误处理

#### 4. Function-Calling-Demo
- 函数注册和注销
- 函数调用详情
- 动态函数管理

#### 5. RAG-Demo
- 文档摄取过程
- 向量搜索查询
- 检索到的文档数量
- RAG 查询和响应

#### 6. Prompt-Engineering-Demo
- 提示模板使用
- 对话记忆管理
- 多轮对话跟踪

#### 7. Agent-Workflow-Demo
- 工作流执行步骤
- 并行任务处理
- 路由决策
- 执行时间统计

#### 8. All-Dependencies-Demo
- 依赖加载信息
- 配置验证

#### 9. Spring-AI-Dependency
- 基础依赖加载
- 配置初始化

## 🔍 日志查看

### 实时查看日志

**Windows (PowerShell):**
```powershell
Get-Content logs\sample-spring-ai.log -Wait -Tail 50
```

**Windows (CMD):**
```cmd
type logs\sample-spring-ai.log
```

### 查看错误日志

```powershell
Get-Content logs\error.log
```

### 搜索特定内容

**PowerShell:**
```powershell
Select-String -Path logs\*.log -Pattern "ERROR"
Select-String -Path logs\*.log -Pattern "基础流式响应"
```

### 查看最近的日志

```powershell
Get-Content logs\sample-spring-ai.log -Tail 100
```

## 📈 日志分析

### 常见日志模式

#### 成功的 API 调用
```
INFO  c.e.streaming.service.StreamingService - 基础流式响应: 你好
INFO  c.e.streaming.service.StreamingService - 流式响应完成
```

#### 错误处理
```
ERROR c.e.rag.service.DocumentIngestionService - 文件摄取失败: document.pdf
java.io.IOException: ...
```

#### 性能监控
```
INFO  c.e.agent.workflow.ChainWorkflow - 文档分析链完成，耗时: 2345ms
INFO  c.e.agent.workflow.ParallelWorkflow - 并行分析完成，耗时: 1234ms
```

## 🛠️ 故障排查

### 问题：日志文件未生成

**解决方案：**
1. 检查 `logs/` 目录是否存在（会自动创建）
2. 检查应用是否有写入权限
3. 查看控制台是否有日志输出

### 问题：日志级别不正确

**解决方案：**
1. 检查 `application.yml` 中的日志配置
2. 确认 `logback-spring.xml` 中的 logger 配置
3. 重启应用使配置生效

### 问题：日志文件过大

**解决方案：**
1. 调整 `maxFileSize` 参数
2. 减少 `maxHistory` 保留天数
3. 提高日志级别（如从 DEBUG 改为 INFO）

## 🎨 最佳实践

### 1. 日志级别使用

- **DEBUG**: 详细的调试信息，开发环境使用
- **INFO**: 重要的业务流程信息
- **WARN**: 警告信息，不影响运行但需要注意
- **ERROR**: 错误信息，需要立即处理

### 2. 日志内容

✅ **好的日志：**
```java
log.info("开始文档分析链");
log.info("步骤1：提取关键信息");
log.info("文档分析链完成，耗时: {}ms", processingTime);
```

❌ **不好的日志：**
```java
log.info("开始");  // 不明确
log.info("完成");  // 缺少上下文
```

### 3. 敏感信息

⚠️ **不要记录：**
- API 密钥
- 密码
- 个人身份信息
- 完整的用户数据

✅ **可以记录：**
- 请求 ID
- 用户 ID（脱敏）
- 操作类型
- 执行时间

### 4. 性能考虑

```java
// 使用参数化日志，避免不必要的字符串拼接
log.debug("处理请求: {}, 参数: {}", requestId, params);

// 而不是
log.debug("处理请求: " + requestId + ", 参数: " + params);
```

## 📦 生产环境配置

### 推荐配置

```yaml
logging:
  level:
    root: WARN
    com.example: INFO
    org.springframework.ai: INFO
  file:
    max-size: 50MB
    max-history: 90
```

### 日志聚合

考虑使用日志聚合工具：
- ELK Stack (Elasticsearch, Logstash, Kibana)
- Splunk
- Graylog
- Loki + Grafana

## 🔗 相关资源

- [Logback 官方文档](http://logback.qos.ch/documentation.html)
- [Spring Boot 日志文档](https://docs.spring.io/spring-boot/docs/current/reference/html/features.html#features.logging)
- [SLF4J 文档](http://www.slf4j.org/manual.html)

## 📝 注意事项

1. **日志文件会自动轮转**：当文件达到 10MB 或每天都会创建新文件
2. **日志保留 30 天**：超过 30 天的日志会自动删除
3. **错误日志单独存储**：便于快速定位问题
4. **UTF-8 编码**：支持中文日志
5. **线程安全**：支持多线程并发写入

## 🎯 快速开始

1. **启动应用**：日志配置自动生效
2. **查看日志**：在 `logs/` 目录下查看
3. **调整级别**：修改 `application.yml` 或 `logback-spring.xml`
4. **重启应用**：使配置生效

---

**提示**：所有子模块都使用相同的日志配置模式，只是日志文件名不同。
