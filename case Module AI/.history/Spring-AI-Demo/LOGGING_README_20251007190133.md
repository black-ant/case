# 📝 日志系统说明

## 快速开始

所有 Spring-AI-Demo 子模块都已配置了完整的日志系统！

### ✅ 已配置的子模块

- ✅ Sample-Spring-AI
- ✅ Multi-LLM-Provider
- ✅ Spring-AI-Dependency
- ✅ Streaming-Demo
- ✅ Function-Calling-Demo
- ✅ Prompt-Engineering-Demo
- ✅ Agent-Workflow-Demo
- ✅ RAG-Demo
- ✅ All-Dependencies-Demo

## 🚀 使用方法

### 1. 启动应用

启动任意子模块后，日志会自动记录到：

```
子模块目录/logs/
├── 模块名.log      # 所有日志
└── error.log       # 错误日志
```

### 2. 查看日志

#### 方法一：使用提供的脚本

```cmd
view-logs.bat
```

选择要查看的子模块，然后选择查看方式。

#### 方法二：直接查看文件

```cmd
type Sample-Spring-AI\logs\sample-spring-ai.log
```

#### 方法三：实时监控（PowerShell）

```powershell
Get-Content Sample-Spring-AI\logs\sample-spring-ai.log -Wait -Tail 50
```

### 3. 验证配置

运行测试脚本：

```cmd
test-logging.bat
```

## 📊 日志内容示例

### 应用启动
```
2025-10-07 14:30:45.123 [main] INFO  c.e.streaming.StreamingDemoApplication - Starting StreamingDemoApplication
2025-10-07 14:30:46.234 [main] INFO  c.e.streaming.StreamingDemoApplication - Started StreamingDemoApplication in 2.5 seconds
```

### API 调用
```
2025-10-07 14:31:00.123 [http-nio-8080-exec-1] INFO  c.e.streaming.service.StreamingService - 基础流式响应: 你好
2025-10-07 14:31:02.456 [http-nio-8080-exec-1] INFO  c.e.streaming.service.StreamingService - 流式响应完成
```

### 错误记录
```
2025-10-07 14:32:00.123 [http-nio-8080-exec-2] ERROR c.e.rag.service.DocumentIngestionService - 文件摄取失败: invalid.pdf
java.io.IOException: 无法读取文件
    at com.example.rag.service.DocumentIngestionService.readPdf(DocumentIngestionService.java:123)
```

## 🎯 日志级别

| 级别 | 说明 | 使用场景 |
|------|------|----------|
| DEBUG | 详细调试信息 | 开发环境，排查问题 |
| INFO | 重要业务信息 | 记录关键流程 |
| WARN | 警告信息 | 潜在问题 |
| ERROR | 错误信息 | 异常和失败 |

## ⚙️ 配置文件

每个子模块都有独立的日志配置：

```
子模块/src/main/resources/logback-spring.xml
```

### 默认配置

- **日志格式**: `yyyy-MM-dd HH:mm:ss.SSS [线程] 级别 类名 - 消息`
- **文件大小**: 单文件最大 10MB
- **保留时间**: 30 天
- **编码**: UTF-8（支持中文）

### 自定义日志级别

在 `application.yml` 中添加：

```yaml
logging:
  level:
    root: INFO
    com.example: DEBUG
    org.springframework.ai: DEBUG
```

## 📚 详细文档

- **[LOGGING_GUIDE.md](./LOGGING_GUIDE.md)** - 完整的日志使用指南
  - 日志配置详解
  - 自定义配置方法
  - 日志查看命令
  - 故障排查
  - 最佳实践

- **[LOGGING_SUMMARY.md](./LOGGING_SUMMARY.md)** - 配置完成总结
  - 已完成的工作
  - 配置特性
  - 日志示例
  - 文件管理

## 🔍 常用命令

### Windows CMD

```cmd
# 查看日志
type logs\sample-spring-ai.log

# 查看错误日志
type logs\error.log

# 查看最后 50 行
powershell "Get-Content logs\sample-spring-ai.log -Tail 50"
```

### Windows PowerShell

```powershell
# 实时监控
Get-Content logs\sample-spring-ai.log -Wait -Tail 50

# 搜索错误
Select-String -Path logs\*.log -Pattern "ERROR"

# 搜索关键词
Select-String -Path logs\*.log -Pattern "流式响应"

# 查看今天的日志
Get-Content logs\sample-spring-ai.log | Select-String (Get-Date -Format "yyyy-MM-dd")
```

## 🎨 日志特性

### ✅ 已实现

- ✅ 控制台输出
- ✅ 文件输出
- ✅ 错误日志分离
- ✅ 自动日志轮转
- ✅ 按大小轮转（10MB）
- ✅ 按时间轮转（每天）
- ✅ 自动清理（30天）
- ✅ UTF-8 编码
- ✅ 线程安全
- ✅ 详细的业务日志
- ✅ 性能统计日志

### 📝 日志内容

各模块记录的关键信息：

- **请求信息**: 用户输入、查询参数
- **执行步骤**: 工作流各个阶段
- **性能数据**: 执行时间、处理速度
- **业务指标**: 文档数量、检索结果
- **错误详情**: 异常堆栈、错误原因

## 🛠️ 故障排查

### 问题：日志文件未生成

**检查项：**
1. 应用是否已启动
2. logs 目录是否有写入权限
3. 查看控制台是否有日志输出

### 问题：日志级别不对

**解决方案：**
1. 检查 `application.yml` 配置
2. 确认 `logback-spring.xml` 配置
3. 重启应用

### 问题：日志文件过大

**解决方案：**
1. 调整 `maxFileSize` 参数
2. 减少 `maxHistory` 天数
3. 提高日志级别（DEBUG → INFO）

## 📦 生产环境建议

### 推荐配置

```yaml
logging:
  level:
    root: WARN
    com.example: INFO
    org.springframework.ai: INFO
```

### 日志监控

考虑集成：
- ELK Stack (Elasticsearch + Logstash + Kibana)
- Prometheus + Grafana
- Splunk
- Graylog

## 🎯 最佳实践

### ✅ 好的日志

```java
log.info("开始处理请求: requestId={}, userId={}", requestId, userId);
log.info("查询完成: 检索到 {} 个文档，耗时 {}ms", count, duration);
log.error("处理失败: {}", errorMessage, exception);
```

### ❌ 避免的日志

```java
log.info("开始");  // 不明确
log.info("完成");  // 缺少上下文
log.info("API Key: " + apiKey);  // 泄露敏感信息
```

## 📞 获取帮助

如有问题，请查看：
1. [LOGGING_GUIDE.md](./LOGGING_GUIDE.md) - 详细指南
2. [LOGGING_SUMMARY.md](./LOGGING_SUMMARY.md) - 配置总结
3. 各子模块的 README.md

---

**配置完成**: 2025-10-07  
**子模块数**: 9  
**状态**: ✅ 全部完成
