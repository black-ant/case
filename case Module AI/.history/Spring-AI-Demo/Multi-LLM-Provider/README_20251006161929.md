# Multi-LLM-Provider - å¤š LLM æä¾›å•†é›†æˆç¤ºä¾‹

è¿™ä¸ªé¡¹ç›®å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Spring AI é›†æˆå¤šä¸ªä¸»æµ LLM æä¾›å•†ï¼ŒåŒ…æ‹¬ OpenAIã€Azure OpenAIã€Anthropic Claude å’Œ Ollama æœ¬åœ°æ¨¡å‹ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

- âœ… **OpenAI** - GPT-3.5/GPT-4 é›†æˆ
- âœ… **Azure OpenAI** - ä¼ä¸šçº§ OpenAI æœåŠ¡
- âœ… **Anthropic Claude** - Claude 3 ç³»åˆ—æ¨¡å‹
- âœ… **Ollama** - æœ¬åœ°è¿è¡Œå¼€æºæ¨¡å‹ï¼ˆLlama2ã€Mistral ç­‰ï¼‰
- âœ… æ¯ä¸ªæä¾›å•†ç‹¬ç«‹çš„ REST API æ¥å£
- âœ… æ”¯æŒç®€å•å¯¹è¯å’Œæµå¼å¯¹è¯
- âœ… ç»Ÿä¸€çš„å“åº”æ ¼å¼
- âœ… å“åº”æ—¶é—´ç»Ÿè®¡

## ğŸ“‹ æ”¯æŒçš„ LLM æä¾›å•†

| æä¾›å•† | æ¨¡å‹ç¤ºä¾‹ | ç‰¹ç‚¹ |
|--------|---------|------|
| **OpenAI** | GPT-3.5-turbo, GPT-4 | æœ€æµè¡Œçš„å•†ä¸š LLM |
| **Azure OpenAI** | GPT-3.5, GPT-4 | ä¼ä¸šçº§éƒ¨ç½²ï¼Œæ•°æ®éšç§ä¿æŠ¤ |
| **Anthropic** | Claude-3-Sonnet, Claude-3-Opus | é•¿ä¸Šä¸‹æ–‡ï¼Œå®‰å…¨æ€§å¼º |
| **Ollama** | Llama2, Mistral, Qwen | æœ¬åœ°è¿è¡Œï¼Œå®Œå…¨ç§æœ‰ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½® API Keys

åœ¨ `application.yml` ä¸­é…ç½®å„ä¸ªæä¾›å•†çš„ API Keyï¼š

```yaml
spring:
  ai:
    openai:
      api-key: ${OPENAI_API_KEY}
    azure:
      openai:
        api-key: ${AZURE_OPENAI_API_KEY}
        endpoint: ${AZURE_OPENAI_ENDPOINT}
    anthropic:
      api-key: ${ANTHROPIC_API_KEY}
    ollama:
      base-url: http://localhost:11434
```

æˆ–é€šè¿‡ç¯å¢ƒå˜é‡è®¾ç½®ï¼š

```bash
# Windows
set OPENAI_API_KEY=sk-xxx
set AZURE_OPENAI_API_KEY=xxx
set AZURE_OPENAI_ENDPOINT=https://xxx.openai.azure.com
set ANTHROPIC_API_KEY=sk-ant-xxx

# Linux/Mac
export OPENAI_API_KEY=sk-xxx
export AZURE_OPENAI_API_KEY=xxx
export AZURE_OPENAI_ENDPOINT=https://xxx.openai.azure.com
export ANTHROPIC_API_KEY=sk-ant-xxx
```

### 2. å®‰è£… Ollamaï¼ˆå¯é€‰ï¼‰

å¦‚æœè¦ä½¿ç”¨æœ¬åœ°æ¨¡å‹ï¼š

```bash
# ä¸‹è½½å¹¶å®‰è£… Ollama
# https://ollama.ai/download

# æ‹‰å–æ¨¡å‹
ollama pull llama2
ollama pull mistral
```

### 3. è¿è¡Œé¡¹ç›®

```bash
mvn spring-boot:run
```

## ğŸ“¡ API æ¥å£

### OpenAI

**ç®€å•å¯¹è¯**
```bash
curl -X POST http://localhost:8080/api/llm/openai/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±"}'
```

**æµå¼å¯¹è¯**
```bash
curl -X POST http://localhost:8080/api/llm/openai/stream \
  -H "Content-Type: application/json" \
  -d '{"message": "è¯·ç”¨ä¸‰å¥è¯ä»‹ç» Java"}'
```

### Azure OpenAI

**ç®€å•å¯¹è¯**
```bash
curl -X POST http://localhost:8080/api/llm/azure/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±"}'
```

**æµå¼å¯¹è¯**
```bash
curl -X POST http://localhost:8080/api/llm/azure/stream \
  -H "Content-Type: application/json" \
  -d '{"message": "è¯·ç”¨ä¸‰å¥è¯ä»‹ç» Java"}'
```

### Anthropic Claude

**ç®€å•å¯¹è¯**
```bash
curl -X POST http://localhost:8080/api/llm/anthropic/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±"}'
```

**æµå¼å¯¹è¯**
```bash
curl -X POST http://localhost:8080/api/llm/anthropic/stream \
  -H "Content-Type: application/json" \
  -d '{"message": "è¯·ç”¨ä¸‰å¥è¯ä»‹ç» Java"}'
```

### Ollamaï¼ˆæœ¬åœ°æ¨¡å‹ï¼‰

**ç®€å•å¯¹è¯**
```bash
curl -X POST http://localhost:8080/api/llm/ollama/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹è‡ªå·±"}'
```

**æµå¼å¯¹è¯**
```bash
curl -X POST http://localhost:8080/api/llm/ollama/stream \
  -H "Content-Type: application/json" \
  -d '{"message": "è¯·ç”¨ä¸‰å¥è¯ä»‹ç» Java"}'
```

### å¥åº·æ£€æŸ¥

```bash
curl http://localhost:8080/api/llm/health
```

## ğŸ“¦ å“åº”æ ¼å¼

**ç®€å•å¯¹è¯å“åº”**ï¼š
```json
{
  "provider": "OpenAI",
  "model": "gpt-3.5-turbo",
  "response": "ä½ å¥½ï¼æˆ‘æ˜¯ ChatGPT...",
  "duration": 1234
}
```

**æµå¼å¯¹è¯å“åº”**ï¼š
```
data: ä½ å¥½
data: ï¼
data: æˆ‘æ˜¯
data: ChatGPT
...
```

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
Multi-LLM-Provider/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ main/
â”‚       â”œâ”€â”€ java/com/example/multillm/
â”‚       â”‚   â”œâ”€â”€ MultiLlmProviderApplication.java    # ä¸»å¯åŠ¨ç±»
â”‚       â”‚   â”œâ”€â”€ config/
â”‚       â”‚   â”‚   â””â”€â”€ WebConfig.java                  # CORS é…ç½®
â”‚       â”‚   â”œâ”€â”€ controller/
â”‚       â”‚   â”‚   â””â”€â”€ LLMController.java              # ç»Ÿä¸€ REST æ§åˆ¶å™¨
â”‚       â”‚   â”œâ”€â”€ service/
â”‚       â”‚   â”‚   â”œâ”€â”€ OpenAIService.java              # OpenAI æœåŠ¡
â”‚       â”‚   â”‚   â”œâ”€â”€ AzureOpenAIService.java         # Azure OpenAI æœåŠ¡
â”‚       â”‚   â”‚   â”œâ”€â”€ AnthropicService.java           # Anthropic æœåŠ¡
â”‚       â”‚   â”‚   â””â”€â”€ OllamaService.java              # Ollama æœåŠ¡
â”‚       â”‚   â””â”€â”€ model/
â”‚       â”‚       â”œâ”€â”€ ChatRequest.java                # è¯·æ±‚æ¨¡å‹
â”‚       â”‚       â””â”€â”€ ChatResponse.java               # å“åº”æ¨¡å‹
â”‚       â””â”€â”€ resources/
â”‚           â””â”€â”€ application.yml                     # é…ç½®æ–‡ä»¶
â””â”€â”€ pom.xml                                         # Maven é…ç½®
```

## ğŸ”§ æŠ€æœ¯æ ˆ

- Spring Boot 3.2.0
- Spring AI 1.0.0-M4
- Spring WebFluxï¼ˆå“åº”å¼ç¼–ç¨‹ï¼‰
- Lombok
- Java 17
- Maven

## ğŸ’¡ ä½¿ç”¨å»ºè®®

### é€‰æ‹©åˆé€‚çš„æä¾›å•†

1. **OpenAI** - é€‚åˆå¿«é€ŸåŸå‹å¼€å‘ï¼ŒAPI ç®€å•æ˜“ç”¨
2. **Azure OpenAI** - é€‚åˆä¼ä¸šåº”ç”¨ï¼Œéœ€è¦æ•°æ®éšç§ä¿æŠ¤
3. **Anthropic Claude** - é€‚åˆéœ€è¦é•¿ä¸Šä¸‹æ–‡çš„åœºæ™¯ï¼ˆ100K+ tokensï¼‰
4. **Ollama** - é€‚åˆç¦»çº¿ç¯å¢ƒã€æ•°æ®æ•æ„Ÿåœºæ™¯ï¼Œå®Œå…¨æœ¬åœ°è¿è¡Œ

### æˆæœ¬è€ƒè™‘

- OpenAI/Azure/Anthropic æŒ‰ token è®¡è´¹
- Ollama å®Œå…¨å…è´¹ï¼Œä½†éœ€è¦æœ¬åœ° GPU/CPU èµ„æº

### æ€§èƒ½å¯¹æ¯”

- **å»¶è¿Ÿ**ï¼šOllamaï¼ˆæœ¬åœ°ï¼‰< OpenAI â‰ˆ Anthropic < Azure OpenAI
- **è´¨é‡**ï¼šGPT-4 > Claude-3-Opus > GPT-3.5 > Llama2
- **æˆæœ¬**ï¼šOllamaï¼ˆå…è´¹ï¼‰< GPT-3.5 < Claude-3 < GPT-4

## ğŸ” å®‰å…¨å»ºè®®

1. ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç  API Key
2. ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–å¯†é’¥ç®¡ç†æœåŠ¡
3. åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ç”¨ HTTPS
4. å®ç°è¯·æ±‚é™æµå’Œè®¤è¯æœºåˆ¶
5. ç›‘æ§ API ä½¿ç”¨é‡å’Œæˆæœ¬

## ğŸ“š æ‰©å±•åŠŸèƒ½

åŸºäºè¿™ä¸ªç¤ºä¾‹ï¼Œä½ å¯ä»¥ç»§ç»­å®ç°ï¼š

- å¤šæ¨¡å‹å¯¹æ¯”ï¼ˆåŒæ—¶è°ƒç”¨å¤šä¸ª LLM å¹¶æ¯”è¾ƒç»“æœï¼‰
- æ™ºèƒ½è·¯ç”±ï¼ˆæ ¹æ®é—®é¢˜ç±»å‹é€‰æ‹©æœ€åˆé€‚çš„æ¨¡å‹ï¼‰
- æˆæœ¬ä¼˜åŒ–ï¼ˆä¼˜å…ˆä½¿ç”¨ä¾¿å®œçš„æ¨¡å‹ï¼Œå¤±è´¥æ—¶é™çº§ï¼‰
- ç¼“å­˜æœºåˆ¶ï¼ˆç›¸åŒé—®é¢˜è¿”å›ç¼“å­˜ç»“æœï¼‰
- å¯¹è¯å†å²ç®¡ç†
- Function Calling é›†æˆ
- RAGï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰

## ğŸ”— å‚è€ƒèµ„æ–™

- [Spring AI å®˜æ–¹æ–‡æ¡£](https://docs.spring.io/spring-ai/reference/)
- [OpenAI API æ–‡æ¡£](https://platform.openai.com/docs)
- [Azure OpenAI æ–‡æ¡£](https://learn.microsoft.com/azure/ai-services/openai/)
- [Anthropic API æ–‡æ¡£](https://docs.anthropic.com/)
- [Ollama å®˜ç½‘](https://ollama.ai/)
