# Agent Workflow Demo - æ™ºèƒ½ä½“æ¨¡å¼ä¸å·¥ä½œæµ

è¿™ä¸ªé¡¹ç›®å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨ Spring AI å®ç°å„ç§æ™ºèƒ½ä½“å·¥ä½œæµæ¨¡å¼ï¼ŒåŒ…æ‹¬é“¾å¼ã€å¹¶è¡Œå’Œè·¯ç”±å·¥ä½œæµã€‚

## ğŸ¯ ä»€ä¹ˆæ˜¯æ™ºèƒ½ä½“å·¥ä½œæµï¼Ÿ

æ™ºèƒ½ä½“å·¥ä½œæµæ˜¯ä¸€ç§å°†å¤æ‚ä»»åŠ¡åˆ†è§£æˆå¤šä¸ªæ­¥éª¤ï¼Œé€šè¿‡ä¸åŒçš„æ‰§è¡Œæ¨¡å¼æ¥å®Œæˆä»»åŠ¡çš„æ–¹æ³•ã€‚

### ä¸‰ç§æ ¸å¿ƒæ¨¡å¼

1. **é“¾å¼å·¥ä½œæµï¼ˆChain Workflowï¼‰**
   - é¡ºåºæ‰§è¡Œå¤šä¸ªæ­¥éª¤
   - æ¯ä¸ªæ­¥éª¤çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€æ­¥çš„è¾“å…¥
   - é€‚åˆéœ€è¦é€æ­¥å¤„ç†çš„ä»»åŠ¡

2. **å¹¶è¡Œå·¥ä½œæµï¼ˆParallel Workflowï¼‰**
   - åŒæ—¶æ‰§è¡Œå¤šä¸ªç‹¬ç«‹ä»»åŠ¡
   - æé«˜å¤„ç†æ•ˆç‡
   - é€‚åˆå¤šè§’åº¦åˆ†æ

3. **è·¯ç”±å·¥ä½œæµï¼ˆRouting Workflowï¼‰**
   - æ ¹æ®è¾“å…¥æ™ºèƒ½é€‰æ‹©å¤„ç†è·¯å¾„
   - åŠ¨æ€å†³ç­–
   - é€‚åˆéœ€è¦åˆ†ç±»å¤„ç†çš„åœºæ™¯

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨åº”ç”¨

```bash
export OPENAI_API_KEY=sk-xxx
mvn spring-boot:run
```

### 2. æµ‹è¯•é“¾å¼å·¥ä½œæµ

```bash
curl -X POST http://localhost:8080/api/workflow/chain/analyze-document \
  -H "Content-Type: application/json" \
  -d '{
    "content": "è¿™æ˜¯ä¸€ç¯‡å…³äºäººå·¥æ™ºèƒ½çš„æ–‡ç« ..."
  }'
```

## ğŸ“¡ API æ¥å£

### é“¾å¼å·¥ä½œæµ

#### 1. é€šç”¨é“¾å¼æ‰§è¡Œ

```bash
curl -X POST http://localhost:8080/api/workflow/chain/execute \
  -H "Content-Type: application/json" \
  -d '{
    "input": "Spring AI æ˜¯ä»€ä¹ˆï¼Ÿ",
    "steps": [
      "ç®€è¦ä»‹ç»",
      "åˆ—å‡ºä¸»è¦ç‰¹æ€§",
      "ç»™å‡ºä½¿ç”¨å»ºè®®"
    ]
  }'
```

**å·¥ä½œæµç¨‹**ï¼š
```
è¾“å…¥ â†’ æ­¥éª¤1 â†’ æ­¥éª¤2 â†’ æ­¥éª¤3 â†’ è¾“å‡º
```

#### 2. æ–‡æ¡£åˆ†æé“¾

```bash
curl -X POST http://localhost:8080/api/workflow/chain/analyze-document \
  -H "Content-Type: application/json" \
  -d '{
    "content": "äººå·¥æ™ºèƒ½æ­£åœ¨æ”¹å˜ä¸–ç•Œ..."
  }'
```

**å·¥ä½œæµç¨‹**ï¼š
```
æ–‡æ¡£ â†’ æå–å…³é”®ä¿¡æ¯ â†’ æƒ…æ„Ÿåˆ†æ â†’ ç”Ÿæˆæ‘˜è¦
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "keyInformation": "å…³é”®ä¿¡æ¯...",
  "sentiment": "ç§¯æã€ä¹è§‚",
  "summary": "ç»¼åˆæ‘˜è¦...",
  "processingTimeMs": 5234
}
```

#### 3. å†…å®¹åˆ›ä½œé“¾

```bash
curl -X POST http://localhost:8080/api/workflow/chain/create-content \
  -H "Content-Type: application/json" \
  -d '{
    "query": "äººå·¥æ™ºèƒ½çš„æœªæ¥"
  }'
```

**å·¥ä½œæµç¨‹**ï¼š
```
ä¸»é¢˜ â†’ å¤´è„‘é£æš´ â†’ åˆ›å»ºå¤§çº² â†’ æ’°å†™å†…å®¹ â†’ æ¶¦è‰²
```

#### 4. ä»£ç å®¡æŸ¥é“¾

```bash
curl -X POST http://localhost:8080/api/workflow/chain/review-code \
  -H "Content-Type: application/json" \
  -d '{
    "content": "public class Hello { ... }"
  }'
```

**å·¥ä½œæµç¨‹**ï¼š
```
ä»£ç  â†’ è¯­æ³•æ£€æŸ¥ â†’ æ€§èƒ½åˆ†æ â†’ å®‰å…¨å®¡æŸ¥ â†’ ç»¼åˆå»ºè®®
```

### å¹¶è¡Œå·¥ä½œæµ

#### 5. é€šç”¨å¹¶è¡Œåˆ†æ

```bash
curl -X POST http://localhost:8080/api/workflow/parallel/analyze \
  -H "Content-Type: application/json" \
  -d '{
    "input": "ç”µåŠ¨æ±½è½¦å¸‚åœº",
    "perspectives": [
      "æŠ€æœ¯å‘å±•",
      "å¸‚åœºè¶‹åŠ¿",
      "ç¯å¢ƒå½±å“",
      "æ”¿ç­–æ”¯æŒ"
    ]
  }'
```

**å·¥ä½œæµç¨‹**ï¼š
```
è¾“å…¥ â†’ â”Œâ”€ è§†è§’1 â”€â”
       â”œâ”€ è§†è§’2 â”€â”¤ â†’ ç»¼åˆç»“æœ
       â”œâ”€ è§†è§’3 â”€â”¤
       â””â”€ è§†è§’4 â”€â”˜
```

#### 6. å¸‚åœºåˆ†æ

```bash
curl -X POST http://localhost:8080/api/workflow/parallel/analyze-market \
  -H "Content-Type: application/json" \
  -d '{
    "marketData": "è‚¡ç¥¨ä»£ç  AAPLï¼Œå½“å‰ä»·æ ¼ $150..."
  }'
```

**å·¥ä½œæµç¨‹**ï¼š
```
å¸‚åœºæ•°æ® â†’ â”Œâ”€ æŠ€æœ¯åˆ†æ â”€â”
           â”œâ”€ åŸºæœ¬é¢åˆ†æ â”€â”¤ â†’ ç»¼åˆåˆ†æ â†’ æŠ•èµ„å»ºè®®
           â”œâ”€ æƒ…ç»ªåˆ†æ â”€â”¤
           â””â”€ é£é™©è¯„ä¼° â”€â”˜
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "perspectiveAnalyses": {
    "æŠ€æœ¯åˆ†æ": "...",
    "åŸºæœ¬é¢åˆ†æ": "...",
    "æƒ…ç»ªåˆ†æ": "...",
    "é£é™©è¯„ä¼°": "..."
  },
  "consolidatedAnalysis": "ç»¼åˆåˆ†æ...",
  "recommendation": "æŠ•èµ„å»ºè®®...",
  "processingTimeMs": 3456
}
```

#### 7. äº§å“è¯„ä¼°

```bash
curl -X POST http://localhost:8080/api/workflow/parallel/evaluate-product \
  -H "Content-Type: application/json" \
  -d '{
    "content": "è¿™æ˜¯ä¸€æ¬¾æ™ºèƒ½æ‰‹è¡¨..."
  }'
```

**å¹¶è¡Œè¯„ä¼°ç»´åº¦**ï¼š
- ç”¨æˆ·ä½“éªŒ
- æŠ€æœ¯å®ç°
- å¸‚åœºç«äº‰åŠ›
- å•†ä¸šä»·å€¼
- åˆ›æ–°æ€§

### è·¯ç”±å·¥ä½œæµ

#### 8. æ™ºèƒ½è·¯ç”±æŸ¥è¯¢

```bash
curl -X POST http://localhost:8080/api/workflow/routing/query \
  -H "Content-Type: application/json" \
  -d '{
    "query": "å¦‚ä½•ä¼˜åŒ– Java ä»£ç æ€§èƒ½ï¼Ÿ"
  }'
```

**å·¥ä½œæµç¨‹**ï¼š
```
æŸ¥è¯¢ â†’ åˆ†ç±»ï¼ˆtechnical/business/creative/scientific/generalï¼‰
     â†’ è·¯ç”±åˆ°ä¸“ä¸šå¤„ç†å™¨ â†’ ä¸“ä¸šå›ç­”
```

**å“åº”ç¤ºä¾‹**ï¼š
```json
{
  "query": "å¦‚ä½•ä¼˜åŒ– Java ä»£ç æ€§èƒ½ï¼Ÿ",
  "category": "technical",
  "response": "ä½œä¸ºèµ„æ·±è½¯ä»¶å·¥ç¨‹å¸ˆï¼Œæˆ‘å»ºè®®..."
}
```

#### 9. å¤æ‚åº¦è·¯ç”±

```bash
curl -X POST http://localhost:8080/api/workflow/routing/by-complexity \
  -H "Content-Type: application/json" \
  -d '{
    "query": "è§£é‡Šé‡å­è®¡ç®—çš„åŸç†åŠå…¶åœ¨å¯†ç å­¦ä¸­çš„åº”ç”¨"
  }'
```

**å·¥ä½œæµç¨‹**ï¼š
```
æŸ¥è¯¢ â†’ è¯„ä¼°å¤æ‚åº¦ï¼ˆsimple/moderate/complexï¼‰
     â†’ é€‰æ‹©å¤„ç†ç­–ç•¥ â†’ æ‰§è¡Œ
```

- **Simple**: ç›´æ¥å›ç­”
- **Moderate**: åˆ†æåå›ç­”
- **Complex**: å¤šæ­¥éª¤æ·±å…¥åˆ†æ

#### 10. æƒ…æ„Ÿè·¯ç”±

```bash
curl -X POST http://localhost:8080/api/workflow/routing/by-emotion \
  -H "Content-Type: application/json" \
  -d '{
    "query": "æˆ‘ä»Šå¤©å¾ˆå¼€å¿ƒï¼Œå­¦ä¼šäº† Spring AIï¼"
  }'
```

**å·¥ä½œæµç¨‹**ï¼š
```
æ¶ˆæ¯ â†’ è¯†åˆ«æƒ…æ„Ÿï¼ˆhappy/sad/angry/confused/neutralï¼‰
     â†’ é€‰æ‹©å›åº”é£æ ¼ â†’ ç”Ÿæˆå›åº”
```

## ğŸ¨ å·¥ä½œæµæ¨¡å¼å¯¹æ¯”

| æ¨¡å¼ | æ‰§è¡Œæ–¹å¼ | é€‚ç”¨åœºæ™¯ | ä¼˜åŠ¿ | åŠ£åŠ¿ |
|------|---------|----------|------|------|
| **é“¾å¼** | é¡ºåºæ‰§è¡Œ | é€æ­¥å¤„ç†ã€ä¾èµ–å…³ç³» | é€»è¾‘æ¸…æ™° | è€—æ—¶è¾ƒé•¿ |
| **å¹¶è¡Œ** | åŒæ—¶æ‰§è¡Œ | å¤šè§’åº¦åˆ†æã€ç‹¬ç«‹ä»»åŠ¡ | æ•ˆç‡é«˜ | èµ„æºæ¶ˆè€—å¤§ |
| **è·¯ç”±** | æ¡ä»¶åˆ†æ”¯ | åˆ†ç±»å¤„ç†ã€åŠ¨æ€å†³ç­– | çµæ´»æ™ºèƒ½ | åˆ†ç±»å‡†ç¡®æ€§ä¾èµ– AI |

## ğŸ’¡ å®é™…åº”ç”¨åœºæ™¯

### 1. æ–‡æ¡£å¤„ç†ç³»ç»Ÿ

**é“¾å¼å·¥ä½œæµ**ï¼š
```
ä¸Šä¼ æ–‡æ¡£ â†’ OCRè¯†åˆ« â†’ ä¿¡æ¯æå– â†’ åˆ†ç±»å½’æ¡£ â†’ ç”Ÿæˆæ‘˜è¦
```

### 2. æ™ºèƒ½å®¢æœç³»ç»Ÿ

**è·¯ç”±å·¥ä½œæµ**ï¼š
```
ç”¨æˆ·é—®é¢˜ â†’ æ„å›¾è¯†åˆ« â†’ è·¯ç”±åˆ°ä¸“ä¸šå®¢æœ â†’ ç”Ÿæˆå›ç­”
```

### 3. å¸‚åœºç ”ç©¶å¹³å°

**å¹¶è¡Œå·¥ä½œæµ**ï¼š
```
ç ”ç©¶ä¸»é¢˜ â†’ å¹¶è¡Œåˆ†æï¼ˆç«å“/ç”¨æˆ·/æŠ€æœ¯/è¶‹åŠ¿ï¼‰â†’ ç»¼åˆæŠ¥å‘Š
```

### 4. å†…å®¹åˆ›ä½œå¹³å°

**é“¾å¼å·¥ä½œæµ**ï¼š
```
ä¸»é¢˜ â†’ è°ƒç ” â†’ å¤§çº² â†’ åˆç¨¿ â†’ å®¡æ ¡ â†’ å‘å¸ƒ
```

### 5. ä»£ç å®¡æŸ¥ç³»ç»Ÿ

**é“¾å¼ + å¹¶è¡Œ**ï¼š
```
ä»£ç  â†’ å¹¶è¡Œæ£€æŸ¥ï¼ˆè¯­æ³•/æ€§èƒ½/å®‰å…¨ï¼‰â†’ ç»¼åˆè¯„åˆ† â†’ ç”ŸæˆæŠ¥å‘Š
```

## ğŸ”§ é…ç½®è¯´æ˜

### ä¸“ä¸šåŒ– ChatClient

```java
@Bean
public Map<String, ChatClient> specializedClients(ChatClient.Builder builder) {
    return Map.of(
        "technical", builder
            .defaultSystem("ä½ æ˜¯ä¸€ä¸ªèµ„æ·±è½¯ä»¶å·¥ç¨‹å¸ˆ...")
            .build(),
        "business", builder
            .defaultSystem("ä½ æ˜¯ä¸€ä¸ªå•†ä¸šé¡¾é—®...")
            .build()
    );
}
```

### å¼‚æ­¥ä»»åŠ¡æ‰§è¡Œå™¨

```yaml
spring:
  task:
    execution:
      pool:
        core-size: 10
        max-size: 20
        queue-capacity: 100
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. é“¾å¼å·¥ä½œæµä¼˜åŒ–

- å‡å°‘ä¸å¿…è¦çš„æ­¥éª¤
- ç¼“å­˜ä¸­é—´ç»“æœ
- ä½¿ç”¨æµå¼å“åº”

### 2. å¹¶è¡Œå·¥ä½œæµä¼˜åŒ–

- åˆç†è®¾ç½®çº¿ç¨‹æ± å¤§å°
- é¿å…è¿‡å¤šå¹¶è¡Œä»»åŠ¡
- å®ç°è¶…æ—¶æœºåˆ¶

### 3. è·¯ç”±å·¥ä½œæµä¼˜åŒ–

- ä¼˜åŒ–åˆ†ç±»å‡†ç¡®æ€§
- ç¼“å­˜åˆ†ç±»ç»“æœ
- é¢„åŠ è½½ä¸“ä¸šæ¨¡å‹

## ğŸ“ æœ€ä½³å®è·µ

### 1. é€‰æ‹©åˆé€‚çš„å·¥ä½œæµæ¨¡å¼

```java
// æœ‰ä¾èµ–å…³ç³» â†’ é“¾å¼
if (hasSequentialDependency) {
    return chainWorkflow.execute();
}

// ç‹¬ç«‹ä»»åŠ¡ â†’ å¹¶è¡Œ
if (hasIndependentTasks) {
    return parallelWorkflow.execute();
}

// éœ€è¦åˆ†ç±» â†’ è·¯ç”±
if (needsClassification) {
    return routingWorkflow.execute();
}
```

### 2. é”™è¯¯å¤„ç†

```java
try {
    return workflow.execute();
} catch (Exception e) {
    log.error("å·¥ä½œæµæ‰§è¡Œå¤±è´¥", e);
    return fallbackResponse();
}
```

### 3. ç›‘æ§å’Œæ—¥å¿—

```java
@Slf4j
public class Workflow {
    public String execute() {
        long start = System.currentTimeMillis();
        try {
            String result = doExecute();
            log.info("å·¥ä½œæµå®Œæˆï¼Œè€—æ—¶: {}ms", System.currentTimeMillis() - start);
            return result;
        } catch (Exception e) {
            log.error("å·¥ä½œæµå¤±è´¥", e);
            throw e;
        }
    }
}
```

## ğŸ“ æ€»ç»“

è¿™ä¸ª Agent Workflow Demo å±•ç¤ºäº†ï¼š

âœ… **é“¾å¼å·¥ä½œæµ**ï¼šæ–‡æ¡£åˆ†æã€å†…å®¹åˆ›ä½œã€ä»£ç å®¡æŸ¥  
âœ… **å¹¶è¡Œå·¥ä½œæµ**ï¼šå¸‚åœºåˆ†æã€äº§å“è¯„ä¼°ã€å¤šè§’åº¦åˆ†æ  
âœ… **è·¯ç”±å·¥ä½œæµ**ï¼šæ™ºèƒ½åˆ†ç±»ã€å¤æ‚åº¦è·¯ç”±ã€æƒ…æ„Ÿè·¯ç”±  
âœ… **ä¸“ä¸šåŒ– Agent**ï¼šæŠ€æœ¯ã€å•†ä¸šã€åˆ›æ„ã€ç§‘å­¦ä¸“å®¶  
âœ… **å¼‚æ­¥å¤„ç†**ï¼šæé«˜å¹¶è¡Œå·¥ä½œæµæ•ˆç‡  

é€šè¿‡æ™ºèƒ½ä½“å·¥ä½œæµï¼Œä½ å¯ä»¥æ„å»ºå‡ºå¼ºå¤§ã€çµæ´»ã€é«˜æ•ˆçš„ AI åº”ç”¨ï¼
