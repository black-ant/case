# 日志配置完成总结

## ✅ 已完成的工作

### 1. 为所有子模块添加了 Logback 配置文件

已为以下 9 个子模块创建了 `logback-spring.xml` 配置文件：

| 子模块 | 配置文件路径 | 日志文件名 |
|--------|-------------|-----------|
| Sample-Spring-AI | `src/main/resources/logback-spring.xml` | `sample-spring-ai.log` |
| Multi-LLM-Provider | `src/main/resources/logback-spring.xml` | `multi-llm-provider.log` |
| Spring-AI-Dependency | `src/main/resources/logback-spring.xml` | `spring-ai-dependency.log` |
| Streaming-Demo | `src/main/resources/logback-spring.xml` | `streaming-demo.log` |
| Function-Calling-Demo | `src/main/resources/logback-spring.xml` | `function-calling-demo.log` |
| Prompt-Engineering-Demo | `src/main/resources/logback-spring.xml` | `prompt-engineering-demo.log` |
| Agent-Workflow-Demo | `src/main/resources/logback-spring.xml` | `agent-workflow-demo.log` |
| RAG-Demo | `src/main/resources/logback-spring.xml` | `rag-demo.log` |
| All-Dependencies-Demo | `src/main/resources/logback-spring.xml` | `all-dependencies-demo.log` |

### 2. 日志配置特性

每个配置文件都包含：

#### 📝 三个日志输出器（Appender）

1. **CONSOLE** - 控制台输出
   - 实时查看应用运行状态
   - UTF-8 编码支持中文

2. **FILE_ALL** - 所有日志文件
   - 记录所有级别的日志
   - 按日期和大小自动轮转
   - 单文件最大 10MB
   - 保留 30 天

3. **FILE_ERROR** - 错误日志文件
   - 只记录 ERROR 级别
   - 便于快速定位问题
   - 保留 30 天

#### 🎯 日志级别配置

```xml
<logger name="org.springframework.ai" level="DEBUG"/>      <!-- Spring AI 框架 -->
<logger name="com.example.*" level="DEBUG"/>               <!-- 应用代码 -->
<logger name="org.springframework" level="INFO"/>          <!-- Spring 框架 -->
<root level="INFO"/>                                       <!-- 默认级别 -->
```

#### 📊 日志格式

```
yyyy-MM-dd HH:mm:ss.SSS [线程名] 级别 类名 - 消息
```

### 3. 已有日志的类

以下关键类已经使用 `@Slf4j` 注解并包含详细的日志记录：

#### Streaming-Demo
- ✅ `StreamingService` - 12 个流式响应方法，每个都有日志

#### RAG-Demo
- ✅ `RAGService` - 5 个 RAG 方法，记录查询和检索详情
- ✅ `DocumentIngestionService` - 文档摄取全流程日志

#### Function-Calling-Demo
- ✅ `DynamicFunctionService` - 动态函数注册和调用日志

#### Prompt-Engineering-Demo
- ✅ `PromptTemplateService` - 6 个提示模板方法
- ✅ `ConversationMemoryService` - 对话记忆管理日志

#### Agent-Workflow-Demo
- ✅ `ChainWorkflow` - 链式工作流，包含执行时间统计
- ✅ `ParallelWorkflow` - 并行工作流，记录并发执行
- ✅ `RoutingWorkflow` - 路由工作流，记录决策过程

### 4. 文档

创建了两个日志相关文档：

1. **LOGGING_GUIDE.md** - 完整的日志使用指南
   - 日志配置说明
   - 自定义配置方法
   - 日志查看命令
   - 故障排查
   - 最佳实践

2. **LOGGING_SUMMARY.md** - 本文档，配置总结

### 5. .gitignore 更新

已更新 `.gitignore` 文件，忽略日志文件和目录：

```gitignore
# Logs
*.log
logs/
**/logs/
```

## 🎯 日志记录的内容

### 各模块记录的关键信息

#### 1. 请求信息
```java
log.info("基础流式响应: {}", message);
log.info("开始文档分析链");
log.info("动态注册函数: {}", functionName);
```

#### 2. 执行步骤
```java
log.info("步骤1：提取关键信息");
log.info("步骤2：情感分析");
log.info("步骤3：生成摘要");
```

#### 3. 性能统计
```java
log.info("文档分析链完成，耗时: {}ms", processingTime);
log.info("并行分析完成，耗时: {}ms", processingTime);
```

#### 4. 错误处理
```java
log.error("流式响应错误: ", error);
log.error("文件摄取失败: {}", filename, e);
```

#### 5. 业务逻辑
```java
log.info("检索到 {} 个相关文档", documents.size());
log.info("查询分类为: {}", category);
log.info("问题复杂度: {}", complexity);
```

## 📋 使用方法

### 启动应用后查看日志

1. **控制台实时输出**
   ```
   2025-10-07 14:30:45.123 [main] INFO  c.e.streaming.StreamingDemoApplication - Starting StreamingDemoApplication
   ```

2. **日志文件**
   ```
   logs/
   ├── streaming-demo.log          # 所有日志
   ├── streaming-demo.2025-10-07.0.log  # 轮转的历史日志
   └── error.log                   # 错误日志
   ```

### 查看日志命令

**Windows PowerShell:**
```powershell
# 实时查看
Get-Content logs\streaming-demo.log -Wait -Tail 50

# 查看错误
Get-Content logs\error.log

# 搜索关键词
Select-String -Path logs\*.log -Pattern "ERROR"
```

### 调整日志级别

在 `application.yml` 中添加：

```yaml
logging:
  level:
    com.example.streaming: DEBUG    # 应用代码详细日志
    org.springframework.ai: INFO    # Spring AI 信息日志
    root: WARN                       # 其他组件警告级别
```

## 🔍 日志示例

### 成功的流式响应
```
2025-10-07 14:30:45.123 [http-nio-8080-exec-1] INFO  c.e.streaming.service.StreamingService - 基础流式响应: 你好
2025-10-07 14:30:47.456 [http-nio-8080-exec-1] INFO  c.e.streaming.service.StreamingService - 流式响应完成
```

### RAG 查询
```
2025-10-07 14:31:00.123 [http-nio-8080-exec-2] INFO  c.e.rag.service.RAGService - 基础 RAG 查询: 什么是 Spring AI?
2025-10-07 14:31:01.234 [http-nio-8080-exec-2] INFO  c.e.rag.service.RAGService - 检索到 5 个相关文档
```

### 文档摄取
```
2025-10-07 14:32:00.123 [http-nio-8080-exec-3] INFO  c.e.rag.service.DocumentIngestionService - 开始摄取文件: document.pdf
2025-10-07 14:32:01.234 [http-nio-8080-exec-3] INFO  c.e.rag.service.DocumentIngestionService - 读取 PDF 文件: document.pdf
2025-10-07 14:32:02.345 [http-nio-8080-exec-3] INFO  c.e.rag.service.DocumentIngestionService - 文件摄取完成: 15 个文档块
```

### 工作流执行
```
2025-10-07 14:33:00.123 [http-nio-8080-exec-4] INFO  c.e.agent.workflow.ChainWorkflow - 开始链式工作流，共 3 个步骤
2025-10-07 14:33:01.234 [http-nio-8080-exec-4] INFO  c.e.agent.workflow.ChainWorkflow - 执行步骤 1/3: 提取关键信息
2025-10-07 14:33:02.345 [http-nio-8080-exec-4] INFO  c.e.agent.workflow.ChainWorkflow - 步骤 1 完成，输出长度: 256
2025-10-07 14:33:03.456 [http-nio-8080-exec-4] INFO  c.e.agent.workflow.ChainWorkflow - 执行步骤 2/3: 情感分析
2025-10-07 14:33:04.567 [http-nio-8080-exec-4] INFO  c.e.agent.workflow.ChainWorkflow - 步骤 2 完成，输出长度: 128
2025-10-07 14:33:05.678 [http-nio-8080-exec-4] INFO  c.e.agent.workflow.ChainWorkflow - 执行步骤 3/3: 生成摘要
2025-10-07 14:33:06.789 [http-nio-8080-exec-4] INFO  c.e.agent.workflow.ChainWorkflow - 步骤 3 完成，输出长度: 512
2025-10-07 14:33:06.890 [http-nio-8080-exec-4] INFO  c.e.agent.workflow.ChainWorkflow - 文档分析链完成，耗时: 6767ms
```

### 错误日志
```
2025-10-07 14:34:00.123 [http-nio-8080-exec-5] ERROR c.e.rag.service.DocumentIngestionService - 文件摄取失败: invalid.pdf
java.io.IOException: 无法读取文件
    at com.example.rag.service.DocumentIngestionService.readPdf(DocumentIngestionService.java:123)
    ...
```

## 🎨 日志级别说明

| 级别 | 用途 | 示例 |
|------|------|------|
| **DEBUG** | 详细的调试信息 | 参数值、中间结果 |
| **INFO** | 重要的业务流程 | 请求开始、完成、关键步骤 |
| **WARN** | 警告信息 | 降级处理、重试 |
| **ERROR** | 错误信息 | 异常、失败 |

## 📊 日志文件管理

### 自动轮转规则

1. **按大小轮转**：单个文件达到 10MB 时创建新文件
2. **按时间轮转**：每天创建新文件
3. **自动清理**：保留最近 30 天的日志

### 文件命名规则

```
streaming-demo.log                    # 当前日志
streaming-demo.2025-10-07.0.log      # 今天的第1个轮转文件
streaming-demo.2025-10-07.1.log      # 今天的第2个轮转文件
streaming-demo.2025-10-06.0.log      # 昨天的日志
```

## 🚀 下一步

### 开发环境
- 日志级别保持 DEBUG，便于调试
- 查看控制台和文件日志
- 使用日志分析问题

### 生产环境
建议调整配置：

```yaml
logging:
  level:
    root: WARN
    com.example: INFO
    org.springframework.ai: INFO
```

### 日志监控
考虑集成：
- ELK Stack（Elasticsearch + Logstash + Kibana）
- Prometheus + Grafana
- Splunk
- Graylog

## 📚 相关文档

- [LOGGING_GUIDE.md](./LOGGING_GUIDE.md) - 详细的日志使用指南
- [README.md](./README.md) - 项目总体说明

## ✨ 特点总结

1. ✅ **统一配置**：所有子模块使用相同的日志配置模式
2. ✅ **详细记录**：关键业务逻辑都有日志记录
3. ✅ **性能监控**：记录执行时间，便于性能分析
4. ✅ **错误追踪**：单独的错误日志文件，快速定位问题
5. ✅ **自动管理**：日志自动轮转和清理
6. ✅ **中文支持**：UTF-8 编码，支持中文日志
7. ✅ **线程安全**：支持多线程并发写入
8. ✅ **易于调试**：详细的上下文信息

---

**配置完成时间**: 2025-10-07  
**配置的子模块数**: 9  
**创建的配置文件数**: 9  
**文档数**: 2
