# AI 智能客服系统 - 测试指南

## 🎯 TestController 功能说明

TestController 提供了完整的自动化测试接口，展示项目的所有核心功能。

## 📡 测试接口列表

### 基础接口

#### 1. 健康检查
```http
GET http://localhost:8080/api/test/health
```
检查服务是否正常运行。

#### 2. 系统信息
```http
GET http://localhost:8080/api/test/system-info
```
获取系统配置和功能信息。

### 功能测试接口

#### 测试 1：基础对话
```http
GET http://localhost:8080/api/test/1-basic-chat
```
**测试内容：**
- AI 基本对话能力
- 会话创建
- 消息发送和接收

**预期结果：**
- AI 友好地介绍自己
- 返回会话 ID 和对话内容

#### 测试 2：知识库检索 (RAG)
```http
GET http://localhost:8080/api/test/2-knowledge-base
```
**测试内容：**
- 向量存储和检索
- 语义搜索
- 知识库问答

**预期结果：**
- 找到相关文档
- AI 基于知识库回答问题

#### 测试 3：订单查询 (Function Calling)
```http
GET http://localhost:8080/api/test/3-function-order-query
```
**测试内容：**
- Function Calling 功能
- 订单查询工具调用
- AI 自动选择和调用函数

**预期结果：**
- 成功调用 orderQueryFunction
- 返回订单详细信息

#### 测试 4：物流追踪 (Function Calling)
```http
GET http://localhost:8080/api/test/4-function-tracking
```
**测试内容：**
- 物流追踪功能
- trackingQueryFunction 调用

**预期结果：**
- 返回物流单号和状态
- AI 解释物流信息

#### 测试 5：创建工单 (Function Calling)
```http
GET http://localhost:8080/api/test/5-function-create-ticket
```
**测试内容：**
- 工单创建功能
- ticketCreateFunction 调用

**预期结果：**
- 成功创建工单
- 返回工单 ID

#### 测试 6：多轮对话
```http
GET http://localhost:8080/api/test/6-multi-turn-conversation
```
**测试内容：**
- 上下文记忆
- 多轮对话能力
- 会话历史管理

**预期结果：**
- AI 记住之前的对话
- 能够理解上下文引用

#### 测试 7：数据库查询
```http
GET http://localhost:8080/api/test/7-database-query
```
**测试内容：**
- 数据持久化
- JPA 查询功能

**预期结果：**
- 返回所有订单数据
- 显示数据库正常工作

### 综合测试

#### 运行所有测试
```http
GET http://localhost:8080/api/test/run-all
```
**功能：**
- 自动运行所有测试
- 生成测试报告
- 统计成功/失败数量

**返回示例：**
```json
{
  "title": "AI 智能客服系统 - 完整功能测试",
  "timestamp": 1234567890,
  "tests": {
    "test1_basicChat": { ... },
    "test2_knowledgeBase": { ... },
    ...
  },
  "summary": {
    "total": 7,
    "success": 7,
    "failed": 0
  }
}
```

## 🚀 快速开始

### 1. 启动应用
```bash
cd AI-Customer-Service
mvn spring-boot:run
```

### 2. 运行完整测试
打开浏览器访问：
```
http://localhost:8080/api/test/run-all
```

### 3. 查看系统信息
```
http://localhost:8080/api/test/system-info
```

## 📊 测试场景

### 场景 1：新用户咨询
```
1. 访问 /api/test/1-basic-chat
2. AI 介绍自己
3. 建立初步联系
```

### 场景 2：查询政策
```
1. 访问 /api/test/2-knowledge-base
2. 查询"退货政策"
3. AI 从知识库检索并回答
```

### 场景 3：订单查询
```
1. 访问 /api/test/3-function-order-query
2. 查询订单 ORD20251019001
3. AI 调用工具函数获取订单信息
```

### 场景 4：物流追踪
```
1. 访问 /api/test/4-function-tracking
2. 查询物流信息
3. 返回追踪号和状态
```

### 场景 5：问题反馈
```
1. 访问 /api/test/5-function-create-ticket
2. 描述商品问题
3. AI 自动创建工单
```

### 场景 6：连续对话
```
1. 访问 /api/test/6-multi-turn-conversation
2. 进行3轮对话
3. 验证上下文记忆
```

## 🔍 使用 curl 测试

### 健康检查
```bash
curl http://localhost:8080/api/test/health
```

### 运行所有测试
```bash
curl http://localhost:8080/api/test/run-all | jq '.'
```

### 单独测试
```bash
# 测试基础对话
curl http://localhost:8080/api/test/1-basic-chat | jq '.'

# 测试知识库
curl http://localhost:8080/api/test/2-knowledge-base | jq '.'

# 测试订单查询
curl http://localhost:8080/api/test/3-function-order-query | jq '.'
```

## 📝 测试结果说明

### 成功响应
```json
{
  "test": "测试名称",
  "description": "测试描述",
  "status": "SUCCESS",
  "userMessage": "用户输入",
  "aiResponse": "AI 回复",
  ...
}
```

### 失败响应
```json
{
  "test": "测试名称",
  "status": "ERROR",
  "error": "错误信息"
}
```

## 🎨 Web 界面测试

除了 API 测试，还可以通过 Web 界面测试：

1. 访问：http://localhost:8080
2. 点击快捷按钮或输入问题
3. 观察 AI 的回复和功能调用

## 📊 测试覆盖

| 功能 | 测试接口 | 覆盖率 |
|------|---------|--------|
| 基础对话 | test/1-basic-chat | ✅ 100% |
| RAG 检索 | test/2-knowledge-base | ✅ 100% |
| 订单查询 | test/3-function-order-query | ✅ 100% |
| 物流追踪 | test/4-function-tracking | ✅ 100% |
| 工单创建 | test/5-function-create-ticket | ✅ 100% |
| 多轮对话 | test/6-multi-turn-conversation | ✅ 100% |
| 数据持久化 | test/7-database-query | ✅ 100% |

## 🐛 故障排查

### 测试失败
1. 检查应用是否正常启动
2. 查看控制台日志
3. 确认 API Key 配置正确
4. 检查网络连接

### API 调用失败
1. 验证 API Key 是否有效
2. 检查 base-url 是否正确
3. 查看详细错误信息

### 数据库问题
1. 访问 H2 控制台检查数据
2. 确认测试数据已初始化
3. 检查 JPA 配置

## 💡 最佳实践

1. **首次测试**
   - 先运行 health 检查
   - 再运行 system-info
   - 最后运行 run-all

2. **调试问题**
   - 单独运行失败的测试
   - 查看详细的错误信息
   - 检查相关日志

3. **性能测试**
   - 多次运行测试观察响应时间
   - 检查 API 调用次数
   - 监控资源使用

---

**开始测试你的 AI 智能客服系统吧！** 🚀
