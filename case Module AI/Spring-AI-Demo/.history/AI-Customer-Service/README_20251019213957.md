# AI æ™ºèƒ½å®¢æœç³»ç»Ÿ

é›†æˆäº† Spring AI å¤šé¡¹åŠŸèƒ½çš„å®Œæ•´ AI å®¢æœåº”ç”¨ï¼Œå±•ç¤ºäº† RAGã€Function Callingã€Streamingã€Agent Workflow ç­‰æ ¸å¿ƒåŠŸèƒ½ã€‚

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

- âœ… **çŸ¥è¯†åº“æ£€ç´¢** - åŸºäºå…³é”®è¯çš„ç®€å•æ£€ç´¢ï¼ˆä¸ä¾èµ– Embeddings APIï¼‰
- âœ… **Function Callingï¼ˆå·¥å…·è°ƒç”¨ï¼‰** - è®¢å•æŸ¥è¯¢ã€ç‰©æµè¿½è¸ªã€å·¥å•ç®¡ç†
- âœ… **Streamingï¼ˆæµå¼å“åº”ï¼‰** - SSE å®æ—¶è¾“å‡ºï¼Œæå‡ç”¨æˆ·ä½“éªŒ
- âœ… **Prompt Engineeringï¼ˆæç¤ºå·¥ç¨‹ï¼‰** - ä¸“ä¸šå®¢æœè¯æœ¯
- âœ… **Agent Workflowï¼ˆæ™ºèƒ½å·¥ä½œæµï¼‰** - å¤šæ­¥éª¤é—®é¢˜è§£å†³
- âœ… **ä¼šè¯ç®¡ç†** - å®Œæ•´çš„å¯¹è¯å†å²è®°å½•
- âœ… **Web ç•Œé¢** - ç°ä»£åŒ–çš„èŠå¤©ç•Œé¢

> **æ³¨æ„**ï¼šå½“å‰ä½¿ç”¨ç®€å•çš„å…³é”®è¯åŒ¹é…è¿›è¡ŒçŸ¥è¯†åº“æ£€ç´¢ï¼Œä¸éœ€è¦ Embeddings APIã€‚å¦‚æœéœ€è¦æ›´é«˜çº§çš„è¯­ä¹‰æœç´¢ï¼Œå¯ä»¥é…ç½®æ”¯æŒ embeddings çš„ APIã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒè¦æ±‚

- JDK 21
- Maven 3.6+

### 2. é…ç½® API

é¡¹ç›®å·²é…ç½® DeepSeek APIï¼ˆOpenAI å…¼å®¹ï¼‰ï¼Œæ— éœ€é¢å¤–è®¾ç½®ã€‚

**é»˜è®¤é…ç½®ï¼š**
```yaml
DEEPSEEK_API_KEY: sk-4ZkNj89GHt26K4lyfl1JNOQuPtUeV5ktXUs8T1VbJ1iS7R5Y
DEEPSEEK_API_URL: https://992236.xyz/v1
DEEPSEEK_MODEL: gemini-2.5-pro
```

**è‡ªå®šä¹‰é…ç½®ï¼ˆå¯é€‰ï¼‰ï¼š**
```bash
# Windows
set DEEPSEEK_API_KEY=your-key
set DEEPSEEK_API_URL=https://your-api-url/v1
set DEEPSEEK_MODEL=your-model

# Linux/Mac
export DEEPSEEK_API_KEY=your-key
export DEEPSEEK_API_URL=https://your-api-url/v1
export DEEPSEEK_MODEL=your-model
```

### 3. å¯åŠ¨åº”ç”¨

```bash
cd AI-Customer-Service
mvn clean spring-boot:run
```

### 4. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š**http://localhost:8080**

## ğŸ’¡ ä½¿ç”¨ç¤ºä¾‹

### åœºæ™¯ 1ï¼šæŸ¥è¯¢è®¢å•
```
ç”¨æˆ·ï¼šæŸ¥è¯¢æˆ‘çš„è®¢å•
AIï¼š[è‡ªåŠ¨è°ƒç”¨ orderQueryFunction æŸ¥è¯¢è®¢å•ä¿¡æ¯]
```

### åœºæ™¯ 2ï¼šç‰©æµè¿½è¸ª
```
ç”¨æˆ·ï¼šæŸ¥è¯¢è®¢å• ORD20251019001 çš„ç‰©æµ
AIï¼š[è‡ªåŠ¨è°ƒç”¨ trackingQueryFunction è·å–ç‰©æµä¿¡æ¯]
```

### åœºæ™¯ 3ï¼šçŸ¥è¯†åº“é—®ç­”
```
ç”¨æˆ·ï¼šé€€è´§æ”¿ç­–æ˜¯ä»€ä¹ˆï¼Ÿ
AIï¼š[ä»çŸ¥è¯†åº“æ£€ç´¢ç›¸å…³ä¿¡æ¯å¹¶å›ç­”]
```

### åœºæ™¯ 4ï¼šåˆ›å»ºå·¥å•
```
ç”¨æˆ·ï¼šæˆ‘æ”¶åˆ°çš„å•†å“æœ‰è´¨é‡é—®é¢˜
AIï¼š[å¼•å¯¼ç”¨æˆ·æè¿°é—®é¢˜ï¼Œè‡ªåŠ¨è°ƒç”¨ ticketCreateFunction åˆ›å»ºå·¥å•]
```

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
AI-Customer-Service/
â”œâ”€â”€ src/main/java/com/example/customerservice/
â”‚   â”œâ”€â”€ config/              # é…ç½®ç±»
â”‚   â”œâ”€â”€ controller/          # REST API
â”‚   â”œâ”€â”€ dto/                 # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”œâ”€â”€ entity/              # å®ä½“ç±»
â”‚   â”œâ”€â”€ function/            # Function Calling å·¥å…·
â”‚   â”œâ”€â”€ repository/          # æ•°æ®è®¿é—®å±‚
â”‚   â””â”€â”€ service/             # ä¸šåŠ¡é€»è¾‘
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ application.yml      # åº”ç”¨é…ç½®
â”‚   â””â”€â”€ static/
â”‚       â””â”€â”€ index.html       # Web ç•Œé¢
â””â”€â”€ pom.xml
```

## ğŸ“Š æ ¸å¿ƒç»„ä»¶

### 1. CustomerServiceAgent
æ ¸å¿ƒå®¢æœä»£ç†ï¼Œè´Ÿè´£ï¼š
- ä¼šè¯ç®¡ç†
- æ¶ˆæ¯å†å²ç»´æŠ¤
- AI è°ƒç”¨ç¼–æ’
- Function Calling é›†æˆ

### 2. KnowledgeBaseService
çŸ¥è¯†åº“æœåŠ¡ï¼Œæä¾›ï¼š
- æ–‡æ¡£å‘é‡åŒ–
- è¯­ä¹‰æœç´¢
- ä¸Šä¸‹æ–‡å¢å¼º

### 3. Function Tools
- **OrderQueryFunction** - è®¢å•æŸ¥è¯¢
- **TrackingQueryFunction** - ç‰©æµè¿½è¸ª
- **TicketCreateFunction** - å·¥å•åˆ›å»º
- **TicketQueryFunction** - å·¥å•æŸ¥è¯¢

## ğŸ”§ é…ç½®è¯´æ˜

### application.yml

```yaml
spring:
  ai:
    openai:
      api-key: ${DEEPSEEK_API_KEY}
      base-url: ${DEEPSEEK_API_URL}
      chat:
        options:
          model: ${DEEPSEEK_MODEL}
          temperature: 0.7
          max-tokens: 2000
```

### æ•°æ®åº“

ä½¿ç”¨ H2 å†…å­˜æ•°æ®åº“ï¼ŒåŒ…å«ä»¥ä¸‹è¡¨ï¼š
- `chat_sessions` - ä¼šè¯è®°å½•
- `chat_messages` - æ¶ˆæ¯å†å²
- `orders` - è®¢å•ä¿¡æ¯
- `customer_tickets` - å®¢æœå·¥å•

è®¿é—® H2 æ§åˆ¶å°ï¼šhttp://localhost:8080/h2-console
- JDBC URL: `jdbc:h2:mem:customerservice`
- Username: `sa`
- Password: (ç©º)

## ğŸ“¡ API æ¥å£

### åˆ›å»ºä¼šè¯
```http
POST /api/customer-service/session
Content-Type: application/json

{
  "customerId": "CUST001",
  "customerName": "å¼ ä¸‰"
}
```

### å‘é€æ¶ˆæ¯ï¼ˆéæµå¼ï¼‰
```http
POST /api/customer-service/chat
Content-Type: application/json

{
  "sessionId": "xxx",
  "customerId": "CUST001",
  "message": "æŸ¥è¯¢æˆ‘çš„è®¢å•"
}
```

### å‘é€æ¶ˆæ¯ï¼ˆæµå¼ï¼‰
```http
POST /api/customer-service/chat/stream
Content-Type: application/json

{
  "sessionId": "xxx",
  "customerId": "CUST001",
  "message": "é€€è´§æ”¿ç­–æ˜¯ä»€ä¹ˆï¼Ÿ"
}
```

### ç»“æŸä¼šè¯
```http
POST /api/customer-service/session/{sessionId}/end
```

## ğŸ¨ Web ç•Œé¢ç‰¹è‰²

- ç°ä»£åŒ–æ¸å˜è‰²è®¾è®¡
- æµç•…çš„åŠ¨ç”»æ•ˆæœ
- æ”¯æŒæµå¼/éæµå¼åˆ‡æ¢
- å¿«æ·æ“ä½œæŒ‰é’®
- å“åº”å¼å¸ƒå±€

## ğŸ§ª æµ‹è¯•æ•°æ®

ç³»ç»Ÿé¢„ç½®äº†æµ‹è¯•æ•°æ®ï¼š

**å®¢æˆ·ï¼šå¼ ä¸‰ (CUST001)**
- è®¢å• ORD20251019001ï¼šiPhone 15 Proï¼ˆå·²å‘è´§ï¼Œç‰©æµå·ï¼šSF1234567890ï¼‰
- è®¢å• ORD20251019002ï¼šAirPods Proï¼ˆå·²é€è¾¾ï¼‰

**å®¢æˆ·ï¼šæå›› (CUST002)**
- è®¢å• ORD20251019003ï¼šMacBook Proï¼ˆå·²ç¡®è®¤ï¼‰

## ğŸ” æŠ€æœ¯æ ˆ

- Spring Boot 3.x
- Spring AI
- Spring Web MVC + WebFlux
- Spring Data JPA
- H2 Database
- Lombok
- Jackson

## ğŸ“ å¼€å‘è¯´æ˜

### æ·»åŠ æ–°çš„ Function

1. åˆ›å»º Function ç±»å®ç° `Function<Request, Response>`
2. åœ¨ `FunctionConfig` ä¸­æ³¨å†Œ Bean
3. æ·»åŠ  `@Description` æ³¨è§£æè¿°åŠŸèƒ½

### æ‰©å±•çŸ¥è¯†åº“

åœ¨ `KnowledgeBaseService.initKnowledgeBase()` ä¸­æ·»åŠ æ–‡æ¡£ï¼š
```java
new Document("çŸ¥è¯†å†…å®¹", Map.of("category", "åˆ†ç±»"))
```

### è‡ªå®šä¹‰æç¤ºè¯

ä¿®æ”¹ `CustomerServiceAgent.SYSTEM_PROMPT` å¸¸é‡ã€‚

## ğŸ› å¸¸è§é—®é¢˜

**Q: ç«¯å£è¢«å ç”¨ï¼Ÿ**
A: ä¿®æ”¹ `application.yml` ä¸­çš„ `server.port`

**Q: API è°ƒç”¨å¤±è´¥ï¼Ÿ**
A: æ£€æŸ¥ API Key å’Œ base-url é…ç½®æ˜¯å¦æ­£ç¡®

**Q: çŸ¥è¯†åº“æ£€ç´¢ä¸å‡†ç¡®ï¼Ÿ**
A: è°ƒæ•´ Top-K å€¼æˆ–ä¼˜åŒ–æ–‡æ¡£å†…å®¹

## ğŸ“„ è®¸å¯è¯

MIT License

---

[è¿”å›ä¸»é¡µ](../README.md)
