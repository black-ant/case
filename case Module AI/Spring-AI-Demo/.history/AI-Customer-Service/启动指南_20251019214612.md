# AI 智能客服系统 - 启动指南

## ✅ 配置完成清单

- ✅ Java 21 配置
- ✅ DeepSeek API 配置（OpenAI 兼容）
- ✅ 简单的知识库检索（无需 Embeddings API）
- ✅ Function Calling 工具（4个）
- ✅ 流式响应支持
- ✅ Web 界面
- ✅ 测试数据

## 🚀 启动步骤

### 1. 确认环境

```bash
# 检查 Java 版本
java -version
# 应该显示 Java 21

# 检查 Maven 版本
mvn -version
```

### 2. 启动应用

```bash
cd AI-Customer-Service
mvn clean spring-boot:run
```

### 3. 访问应用

打开浏览器访问：**http://localhost:8080**

## 🎯 快速测试

### 测试 1：基础对话
```
输入：你好
预期：AI 会友好地回复
```

### 测试 2：查询订单
```
输入：查询我的订单
预期：AI 会调用 orderQueryFunction 查询订单
```

### 测试 3：知识库查询
```
输入：退货政策是什么？
预期：AI 会从知识库检索相关信息
```

### 测试 4：物流追踪
```
输入：查询订单 ORD20251019001 的物流
预期：AI 会调用 trackingQueryFunction 获取物流信息
```

### 测试 5：创建工单
```
输入：我收到的商品有质量问题
预期：AI 会引导创建工单
```

## 📊 测试数据

系统预置了以下测试数据：

**客户：张三 (CUST001)**
- 订单 ORD20251019001：iPhone 15 Pro（已发货）
- 订单 ORD20251019002：AirPods Pro（已送达）

**客户：李四 (CUST002)**
- 订单 ORD20251019003：MacBook Pro（已确认）

## 🔧 配置说明

### API 配置
```yaml
spring:
  ai:
    openai:
      api-key: sk-4ZkNj89GHt26K4lyfl1JNOQuPtUeV5ktXUs8T1VbJ1iS7R5Y
      base-url: https://992236.xyz/v1
      chat:
        options:
          model: gemini-2.5-pro
```

### 端口配置
默认端口：8080

如需修改，编辑 `application.yml`：
```yaml
server:
  port: 8081
```

## 🐛 常见问题

### Q1: 端口被占用
```bash
# 检查端口占用
netstat -ano | findstr :8080

# 方案 1：关闭占用端口的程序
# 方案 2：修改 application.yml 中的端口
```

### Q2: 编译错误
```bash
# 清理并重新编译
mvn clean install
```

### Q3: API 调用失败
- 检查网络连接
- 确认 API Key 是否有效
- 查看控制台日志

### Q4: 知识库检索不到
- 当前使用关键词匹配
- 确保查询词在知识库内容中存在
- 可以查看 `KnowledgeBaseService.java` 中的知识内容

## 📝 日志查看

启动后查看控制台日志：
- `DEBUG` 级别：详细的调试信息
- `INFO` 级别：一般信息
- `ERROR` 级别：错误信息

## 🎨 Web 界面功能

- ✅ 实时对话
- ✅ 流式/非流式切换
- ✅ 快捷操作按钮
- ✅ 消息历史
- ✅ 动画效果

## 📡 API 测试

### 使用 Postman
导入 `postman_collection.json` 文件

### 使用 curl
```bash
# 创建会话
curl -X POST http://localhost:8080/api/customer-service/session \
  -H "Content-Type: application/json" \
  -d '{"customerId":"CUST001","customerName":"张三"}'

# 发送消息
curl -X POST http://localhost:8080/api/customer-service/chat \
  -H "Content-Type: application/json" \
  -d '{"sessionId":"xxx","customerId":"CUST001","message":"查询订单"}'
```

## 🔍 数据库查看

访问 H2 控制台：http://localhost:8080/h2-console

连接信息：
- JDBC URL: `jdbc:h2:mem:customerservice`
- Username: `sa`
- Password: (空)

可查看的表：
- `chat_sessions` - 会话记录
- `chat_messages` - 消息历史
- `orders` - 订单信息
- `customer_tickets` - 工单记录

## 🎉 启动成功标志

看到以下日志表示启动成功：
```
Tomcat started on port(s): 8080 (http)
Started AiCustomerServiceApplication in X.XXX seconds
```

---

**祝使用愉快！** 🚀

如有问题，请查看 README.md 或控制台日志。
