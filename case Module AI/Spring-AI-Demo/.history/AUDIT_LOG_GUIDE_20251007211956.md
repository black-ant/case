# API å®¡è®¡æ—¥å¿—ä½¿ç”¨æŒ‡å—

## åŠŸèƒ½è¯´æ˜

å·²ä¸ºæ‰€æœ‰é¡¹ç›®çš„ Controller API æ·»åŠ äº†å®¡è®¡æ—¥å¿—åŠŸèƒ½ï¼Œè‡ªåŠ¨è®°å½•ï¼š
- âœ… è¯·æ±‚ IDï¼ˆUUIDï¼‰
- âœ… HTTP æ–¹æ³•å’Œè·¯å¾„
- âœ… Controller ç±»åå’Œæ–¹æ³•å
- âœ… è¯·æ±‚å‚æ•°ï¼ˆå®Œæ•´ JSONï¼‰
- âœ… å“åº”ç»“æœï¼ˆå®Œæ•´ JSONï¼‰
- âœ… æ‰§è¡Œæ—¶é•¿ï¼ˆæ¯«ç§’ï¼‰
- âœ… æˆåŠŸ/å¤±è´¥çŠ¶æ€
- âœ… å¼‚å¸¸ä¿¡æ¯

## å·²æ›´æ–°çš„é¡¹ç›®

æ‰€æœ‰é¡¹ç›®çš„ Controller éƒ½å·²æ·»åŠ  `@ApiAuditLog` æ³¨è§£ï¼š

1. âœ… **Multi-LLM-Provider** - LLMController
2. âœ… **Function-Calling-Demo** - FunctionCallingController, DynamicFunctionController
3. âœ… **Agent-Workflow-Demo** - WorkflowController
4. âœ… **Sample-Spring-AI** - ChatController, AdvancedChatController
5. âœ… **RAG-Demo** - RAGController, DocumentController
6. âœ… **Prompt-Engineering-Demo** - PromptController
7. âœ… **Streaming-Demo** - StreamingController

## æ—¥å¿—æ ¼å¼ç¤ºä¾‹

### åŒæ­¥è¯·æ±‚

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•‘ [AUDIT] Request ID: 550e8400-e29b-41d4-a716-446655440000
â•‘ [AUDIT] Operation: POST /api/llm/openai/chat
â•‘ [AUDIT] Controller: LLMController.openaiChat
â•‘ [AUDIT] Request Body [0]: {"message":"ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ Spring AI"}
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•‘ [AUDIT] Request ID: 550e8400-e29b-41d4-a716-446655440000
â•‘ [AUDIT] Duration: 1234 ms
â•‘ [AUDIT] Status: SUCCESS
â•‘ [AUDIT] Response Body: {"provider":"OpenAI","model":"gpt-3.5-turbo","response":"Spring AI æ˜¯...","duration":1234}
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### æµå¼å“åº”

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•‘ [AUDIT] Request ID: 550e8400-e29b-41d4-a716-446655440000
â•‘ [AUDIT] Operation: POST /api/llm/openai/stream
â•‘ [AUDIT] Controller: LLMController.openaiStreamChat
â•‘ [AUDIT] Request Body [0]: {"message":"å†™ä¸€é¦–è¯—"}
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[AUDIT] Request ID: 550e8400-e29b-41d4-a716-446655440000 - Stream started
[AUDIT] Request ID: 550e8400-e29b-41d4-a716-446655440000 - Stream completed in 2345 ms
```

### å¼‚å¸¸æƒ…å†µ

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•‘ [AUDIT] Request ID: 550e8400-e29b-41d4-a716-446655440000
â•‘ [AUDIT] Operation: POST /api/llm/openai/chat
â•‘ [AUDIT] Controller: LLMController.openaiChat
â•‘ [AUDIT] Request Body [0]: {"message":"æµ‹è¯•"}
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
â•‘ [AUDIT] Request ID: 550e8400-e29b-41d4-a716-446655440000
â•‘ [AUDIT] Duration: 567 ms
â•‘ [AUDIT] Status: FAILED
â•‘ [AUDIT] Error: Connection timeout: Unable to connect to OpenAI API
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## æµ‹è¯•æ–¹æ³•

### 1. å¯åŠ¨ä»»æ„é¡¹ç›®

```bash
# ä¾‹å¦‚å¯åŠ¨ Multi-LLM-Provider
cd Multi-LLM-Provider
mvn spring-boot:run
```

### 2. å‘é€æµ‹è¯•è¯·æ±‚

```bash
# æµ‹è¯• OpenAI å¯¹è¯
curl -X POST http://localhost:8080/api/llm/openai/chat \
  -H "Content-Type: application/json" \
  -d '{"message":"ä½ å¥½"}'

# æµ‹è¯•æµå¼å“åº”
curl -X POST http://localhost:8080/api/llm/openai/stream \
  -H "Content-Type: application/json" \
  -d '{"message":"å†™ä¸€é¦–è¯—"}'
```

### 3. æŸ¥çœ‹æ—¥å¿—

åœ¨æ§åˆ¶å°ä¸­æŸ¥çœ‹å®¡è®¡æ—¥å¿—è¾“å‡ºï¼ŒåŒ…å«å®Œæ•´çš„è¯·æ±‚å’Œå“åº”ä¿¡æ¯ã€‚

## æŠ€æœ¯å®ç°

### æ ¸å¿ƒç»„ä»¶

1. **ApiAuditLog æ³¨è§£** - æ ‡è®°éœ€è¦å®¡è®¡çš„ Controller
2. **ApiAuditAspect åˆ‡é¢** - AOP æ‹¦æˆªå™¨ï¼Œè‡ªåŠ¨è®°å½•æ—¥å¿—
3. **AuditAutoConfiguration** - è‡ªåŠ¨é…ç½®ç±»
4. **spring.factories** - Spring Boot è‡ªåŠ¨é…ç½®

### æ”¯æŒçš„å“åº”ç±»å‹

- âœ… åŒæ­¥å“åº”ï¼ˆString, Object, Map ç­‰ï¼‰
- âœ… Mono<T>ï¼ˆå“åº”å¼å•å€¼ï¼‰
- âœ… Flux<T>ï¼ˆå“åº”å¼æµï¼‰
- âœ… SSEï¼ˆServer-Sent Eventsï¼‰
- âœ… NDJSON

### ç‰¹æ€§

- ğŸ”’ **è‡ªåŠ¨è„±æ•**ï¼šä¸è®°å½• HttpServletRequestã€HttpServletResponse ç­‰å¯¹è±¡
- ğŸ“ **è‡ªåŠ¨æˆªæ–­**ï¼šå“åº”è¶…è¿‡ 2000 å­—ç¬¦è‡ªåŠ¨æˆªæ–­
- âš¡ **æ€§èƒ½ä¼˜åŒ–**ï¼šä½¿ç”¨ AOP åˆ‡é¢ï¼Œå¯¹ä¸šåŠ¡æ€§èƒ½å½±å“æå°
- ğŸ¯ **ç²¾ç¡®è¿½è¸ª**ï¼šæ¯ä¸ªè¯·æ±‚éƒ½æœ‰å”¯ä¸€çš„ Request ID

## é…ç½®é€‰é¡¹

### æ³¨è§£å‚æ•°

```java
@ApiAuditLog(
    value = "æ“ä½œæè¿°",           // å¯é€‰ï¼Œæè¿°è¯¥ API çš„åŠŸèƒ½
    logRequest = true,           // æ˜¯å¦è®°å½•è¯·æ±‚å‚æ•°ï¼Œé»˜è®¤ true
    logResponse = true,          // æ˜¯å¦è®°å½•å“åº”ç»“æœï¼Œé»˜è®¤ true
    logException = true          // æ˜¯å¦è®°å½•å¼‚å¸¸ä¿¡æ¯ï¼Œé»˜è®¤ true
)
```

### ç¦ç”¨å®¡è®¡æ—¥å¿—

å¦‚æœéœ€è¦ç¦ç”¨æŸä¸ªé¡¹ç›®çš„å®¡è®¡æ—¥å¿—ï¼Œåœ¨ `application.yml` ä¸­é…ç½®ï¼š

```yaml
spring:
  autoconfigure:
    exclude:
      - com.example.common.audit.AuditAutoConfiguration
```

## æ³¨æ„äº‹é¡¹

1. **æ•æ„Ÿä¿¡æ¯**ï¼šå®¡è®¡æ—¥å¿—ä¼šè®°å½•å®Œæ•´çš„è¯·æ±‚å’Œå“åº”ï¼Œè¯·æ³¨æ„ä¸è¦åœ¨è¯·æ±‚ä¸­åŒ…å«å¯†ç ã€Token ç­‰æ•æ„Ÿä¿¡æ¯
2. **æ—¥å¿—å¤§å°**ï¼šå»ºè®®é…ç½®æ—¥å¿—æ–‡ä»¶æ»šåŠ¨ç­–ç•¥ï¼Œé¿å…æ—¥å¿—æ–‡ä»¶è¿‡å¤§
3. **æ€§èƒ½å½±å“**ï¼šåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå»ºè®®é…ç½®å¼‚æ­¥æ—¥å¿—
4. **å­˜å‚¨ç©ºé—´**ï¼šå®šæœŸæ¸…ç†æ—§çš„å®¡è®¡æ—¥å¿—æ–‡ä»¶

## æ—¥å¿—é…ç½®å»ºè®®

åœ¨ `application.yml` ä¸­é…ç½®æ—¥å¿—è¾“å‡ºï¼š

```yaml
logging:
  level:
    com.example.common.audit: INFO
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/audit.log
    max-size: 100MB
    max-history: 30
```

## ä¸‹ä¸€æ­¥

1. æ ¹æ®éœ€è¦è°ƒæ•´æ—¥å¿—çº§åˆ«å’Œè¾“å‡ºæ ¼å¼
2. é…ç½®æ—¥å¿—æ–‡ä»¶æ»šåŠ¨ç­–ç•¥
3. è€ƒè™‘å°†å®¡è®¡æ—¥å¿—è¾“å‡ºåˆ°ä¸“é—¨çš„å®¡è®¡ç³»ç»Ÿ
4. æ·»åŠ æ—¥å¿—åˆ†æå’Œç›‘æ§å‘Šè­¦

## ç›¸å…³æ–‡æ¡£

- [spring-ai-common/README.md](spring-ai-common/README.md) - è¯¦ç»†çš„æŠ€æœ¯æ–‡æ¡£
- [Spring AOP æ–‡æ¡£](https://docs.spring.io/spring-framework/reference/core/aop.html)
- [Logback é…ç½®](https://logback.qos.ch/manual/configuration.html)
